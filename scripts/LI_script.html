<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel A. Mendes, Msc">
<meta name="dcterms.date" content="2025-10-01">

<title>Analyses of Hydrology-Induced Changes Drive Fish eDNA Ecology in a Neotropical Reservoir paper</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="LI_script_files/libs/clipboard/clipboard.min.js"></script>
<script src="LI_script_files/libs/quarto-html/quarto.js"></script>
<script src="LI_script_files/libs/quarto-html/popper.min.js"></script>
<script src="LI_script_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="LI_script_files/libs/quarto-html/anchor.min.js"></script>
<link href="LI_script_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="LI_script_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="LI_script_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="LI_script_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="LI_script_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#housekeeping" id="toc-housekeeping" class="nav-link active" data-scroll-target="#housekeeping"><span class="header-section-number">1</span> Housekeeping</a></li>
  <li><a href="#integrating-raw-and-curated-data" id="toc-integrating-raw-and-curated-data" class="nav-link" data-scroll-target="#integrating-raw-and-curated-data"><span class="header-section-number">2</span> Integrating raw and curated data</a>
  <ul class="collapse">
  <li><a href="#obtaining-data" id="toc-obtaining-data" class="nav-link" data-scroll-target="#obtaining-data"><span class="header-section-number">2.1</span> Obtaining data</a></li>
  <li><a href="#data-integration-and-taxonomic-enrichment" id="toc-data-integration-and-taxonomic-enrichment" class="nav-link" data-scroll-target="#data-integration-and-taxonomic-enrichment"><span class="header-section-number">2.2</span> Data integration and Taxonomic Enrichment</a></li>
  <li><a href="#metadata-integration" id="toc-metadata-integration" class="nav-link" data-scroll-target="#metadata-integration"><span class="header-section-number">2.3</span> Metadata integration</a></li>
  <li><a href="#manual-corrections" id="toc-manual-corrections" class="nav-link" data-scroll-target="#manual-corrections"><span class="header-section-number">2.4</span> Manual corrections</a></li>
  <li><a href="#data-filtering" id="toc-data-filtering" class="nav-link" data-scroll-target="#data-filtering"><span class="header-section-number">2.5</span> Data filtering</a></li>
  </ul></li>
  <li><a href="#preliminary-tables" id="toc-preliminary-tables" class="nav-link" data-scroll-target="#preliminary-tables"><span class="header-section-number">3</span> Preliminary tables</a>
  <ul class="collapse">
  <li><a href="#table-s2" id="toc-table-s2" class="nav-link" data-scroll-target="#table-s2"><span class="header-section-number">3.1</span> Table S2</a></li>
  <li><a href="#table-s5" id="toc-table-s5" class="nav-link" data-scroll-target="#table-s5"><span class="header-section-number">3.2</span> Table S5</a></li>
  </ul></li>
  <li><a href="#initial-data-assesment" id="toc-initial-data-assesment" class="nav-link" data-scroll-target="#initial-data-assesment"><span class="header-section-number">4</span> Initial data assesment</a>
  <ul class="collapse">
  <li><a href="#number-of-reads-by-sample-after-sequencing" id="toc-number-of-reads-by-sample-after-sequencing" class="nav-link" data-scroll-target="#number-of-reads-by-sample-after-sequencing"><span class="header-section-number">4.1</span> Number of Reads by sample after sequencing</a></li>
  <li><a href="#number-of-reads-after-post-pipeline-and-filtering" id="toc-number-of-reads-after-post-pipeline-and-filtering" class="nav-link" data-scroll-target="#number-of-reads-after-post-pipeline-and-filtering"><span class="header-section-number">4.2</span> Number of reads after post-pipeline and filtering</a></li>
  <li><a href="#ids-metrics-pre-pipeline-and-filtering" id="toc-ids-metrics-pre-pipeline-and-filtering" class="nav-link" data-scroll-target="#ids-metrics-pre-pipeline-and-filtering"><span class="header-section-number">4.3</span> IDs metrics pre-pipeline and filtering</a></li>
  <li><a href="#ids-metrics-post-pipeline-and-filtering" id="toc-ids-metrics-post-pipeline-and-filtering" class="nav-link" data-scroll-target="#ids-metrics-post-pipeline-and-filtering"><span class="header-section-number">4.4</span> IDs metrics post-pipeline and filtering</a></li>
  <li><a href="#table-s6" id="toc-table-s6" class="nav-link" data-scroll-target="#table-s6"><span class="header-section-number">4.5</span> Table S6</a></li>
  </ul></li>
  <li><a href="#exploratory-data-assesment" id="toc-exploratory-data-assesment" class="nav-link" data-scroll-target="#exploratory-data-assesment"><span class="header-section-number">5</span> Exploratory data assesment</a>
  <ul class="collapse">
  <li><a href="#track-the-evolution-of-read-counts" id="toc-track-the-evolution-of-read-counts" class="nav-link" data-scroll-target="#track-the-evolution-of-read-counts"><span class="header-section-number">5.1</span> Track the evolution of read counts</a></li>
  <li><a href="#listing-identifications-outside-the-species-level" id="toc-listing-identifications-outside-the-species-level" class="nav-link" data-scroll-target="#listing-identifications-outside-the-species-level"><span class="header-section-number">5.2</span> Listing identifications outside the species level</a></li>
  <li><a href="#table-2" id="toc-table-2" class="nav-link" data-scroll-target="#table-2"><span class="header-section-number">5.3</span> Table 2</a></li>
  <li><a href="#summarizing-final-data-by-class" id="toc-summarizing-final-data-by-class" class="nav-link" data-scroll-target="#summarizing-final-data-by-class"><span class="header-section-number">5.4</span> Summarizing final data by class</a></li>
  <li><a href="#table-s3" id="toc-table-s3" class="nav-link" data-scroll-target="#table-s3"><span class="header-section-number">5.5</span> Table S3</a></li>
  <li><a href="#summarizing-final-data-by-family" id="toc-summarizing-final-data-by-family" class="nav-link" data-scroll-target="#summarizing-final-data-by-family"><span class="header-section-number">5.6</span> Summarizing final data by family</a></li>
  <li><a href="#summarizing-total-reads-by-sample" id="toc-summarizing-total-reads-by-sample" class="nav-link" data-scroll-target="#summarizing-total-reads-by-sample"><span class="header-section-number">5.7</span> Summarizing total reads by sample</a></li>
  <li><a href="#identifying-singletons" id="toc-identifying-singletons" class="nav-link" data-scroll-target="#identifying-singletons"><span class="header-section-number">5.8</span> Identifying singletons</a></li>
  </ul></li>
  <li><a href="#exploratory-plots" id="toc-exploratory-plots" class="nav-link" data-scroll-target="#exploratory-plots"><span class="header-section-number">6</span> Exploratory plots</a>
  <ul class="collapse">
  <li><a href="#proportions-of-identified-taxa" id="toc-proportions-of-identified-taxa" class="nav-link" data-scroll-target="#proportions-of-identified-taxa"><span class="header-section-number">6.1</span> Proportions of identified taxa</a></li>
  <li><a href="#figure-2a" id="toc-figure-2a" class="nav-link" data-scroll-target="#figure-2a"><span class="header-section-number">6.2</span> Figure 2A</a></li>
  <li><a href="#alpha-diversity" id="toc-alpha-diversity" class="nav-link" data-scroll-target="#alpha-diversity"><span class="header-section-number">6.3</span> Alpha diversity</a></li>
  <li><a href="#venn-diagram-analysis" id="toc-venn-diagram-analysis" class="nav-link" data-scroll-target="#venn-diagram-analysis"><span class="header-section-number">6.4</span> Venn Diagram Analysis</a></li>
  </ul></li>
  <li><a href="#ecological-analysis" id="toc-ecological-analysis" class="nav-link" data-scroll-target="#ecological-analysis"><span class="header-section-number">7</span> Ecological analysis</a>
  <ul class="collapse">
  <li><a href="#pcoa" id="toc-pcoa" class="nav-link" data-scroll-target="#pcoa"><span class="header-section-number">7.1</span> PCoA</a></li>
  <li><a href="#permanova" id="toc-permanova" class="nav-link" data-scroll-target="#permanova"><span class="header-section-number">7.2</span> PERMANOVA</a></li>
  <li><a href="#species-accumulation-curves" id="toc-species-accumulation-curves" class="nav-link" data-scroll-target="#species-accumulation-curves"><span class="header-section-number">7.3</span> Species accumulation curves</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analyses of Hydrology-Induced Changes Drive Fish eDNA Ecology in a Neotropical Reservoir paper</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriel A. Mendes, Msc </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This pipeline integrates public tools available for metabarcoding analyses from “Analyses of Hydrology-Induced Changes Drive Fish eDNA Ecology in a Neotropical Reservoir” paper. To share or reproduce this content, please require authors’ consent.</p>
<p><strong>Contact:</strong> <a href="mailto:gabrielmendesbrt@gmail.com" class="email">gabrielmendesbrt@gmail.com</a></p>
<section id="housekeeping" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="housekeeping"><span class="header-section-number">1</span> Housekeeping</h2>
<ul>
<li><p>Load project environment and necessary libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"Biostrings"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"DECIPHER"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"phyloseq"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"vegan"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readxl"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggpubr"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggsignif"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"openxlsx"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"colorspace"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Create project folders</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating and loading paths ----</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  prjct_path <span class="ot">&lt;-</span> <span class="st">"/home/gabriel/projetos/LI_paper"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  prjct_radical <span class="ot">&lt;-</span> <span class="st">"eDNA_Lagoa-dos-Ingleses"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  scripts_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prjct_path,<span class="st">"/scripts"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  data_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prjct_path,<span class="st">"/data"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  results_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prjct_path,<span class="st">"/results"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  figs_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(results_path,<span class="st">"/figures"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  tbl_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(results_path,<span class="st">"/tables"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  env_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prjct_path,<span class="st">"/environment"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  paths <span class="ot">&lt;-</span> <span class="fu">c</span>(scripts_path, data_path, results_path,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>             figs_path, tbl_path, env_path)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (dir <span class="cf">in</span> paths) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">dir.exists</span>(dir)) {</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The directory"</span>, dir, <span class="st">"already exists!"</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Making"</span>, dir, <span class="st">"!"</span> ))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir) </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The directory /home/gabriel/projetos/LI_paper/scripts already exists!"
[1] "The directory /home/gabriel/projetos/LI_paper/data already exists!"
[1] "The directory /home/gabriel/projetos/LI_paper/results already exists!"
[1] "The directory /home/gabriel/projetos/LI_paper/results/figures already exists!"
[1] "The directory /home/gabriel/projetos/LI_paper/results/tables already exists!"
[1] "The directory /home/gabriel/projetos/LI_paper/environment already exists!"</code></pre>
</div>
</div></li>
<li><p>Data acquring</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Full results</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>pre_raw_results_tbl <span class="ot">&lt;-</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="fu">paste0</span>(data_path, <span class="st">"/curated-Complete_analysis_results-2024-01-10.xlsx"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Curated ASV identifications</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>curated_ids_tbl <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(data_path, <span class="st">"/curated_lagoa_ingleses-ASVs_x_amostras-2024-01-09.xlsx"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Complete BLASTn taxonomy results</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>blast_tax <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(data_path, <span class="st">"/tax_blast.csv"</span>),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sep =</span> <span class="st">","</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">row.names =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="integrating-raw-and-curated-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="integrating-raw-and-curated-data"><span class="header-section-number">2</span> Integrating raw and curated data</h2>
<section id="obtaining-data" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="obtaining-data"><span class="header-section-number">2.1</span> Obtaining data</h3>
<ul>
<li><p>Selecting colunms and adjusting the raw data table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>pre_raw_results_tbl <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  pre_raw_results_tbl <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"Sample"</span>, <span class="st">"Unique_File_name"</span>, <span class="st">"OTU"</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Abundance"</span>, <span class="st">"Obs. Curadoria"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Possible contamination"</span>, <span class="st">"Read origin"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Primer expected length"</span>, <span class="st">"ASV Size (pb)"</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">"ASV header"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sample =</span> <span class="fu">str_replace</span>(Sample, <span class="st">"__"</span>, <span class="st">"_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Selecting colunms from curated identifications table</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>curated_ids_tbl <span class="ot">&lt;-</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  curated_ids_tbl <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ASV header"</span>, <span class="st">"ASV (Sequence)"</span>, <span class="st">"Curated ID"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Final ID (BLASTn)"</span>, <span class="st">"BLASTn pseudo-score"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Class (BLASTn)"</span>, <span class="st">"Curated Order (BLASTn)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="data-integration-and-taxonomic-enrichment" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="data-integration-and-taxonomic-enrichment"><span class="header-section-number">2.2</span> Data integration and Taxonomic Enrichment</h3>
<ul>
<li><p>Joining the results table with curated identifications</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>raw_results_tbl <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  pre_raw_results_tbl <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(curated_ids_tbl, <span class="at">by =</span> <span class="st">"ASV header"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ASV header"</span>,<span class="st">"ASV (Sequence)"</span>, <span class="st">"Curated ID"</span>, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Final ID (BLASTn)"</span>,<span class="st">"BLASTn pseudo-score"</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Class (BLASTn)"</span>, <span class="st">"Curated Order (BLASTn)"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Sample"</span>, <span class="st">"Unique_File_name"</span>, <span class="st">"OTU"</span>, <span class="st">"Abundance"</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Obs. Curadoria"</span>,<span class="st">"Read origin"</span>, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Primer expected length"</span>, <span class="st">"ASV Size (pb)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Adding complete taxonomy from BLASTr output</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the BLAST taxonomy table</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>blast_tax_less <span class="ot">&lt;-</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  blast_tax <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ASV,<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">`</span><span class="at">ASV (Sequence)</span><span class="st">`</span> <span class="ot">=</span> ASV) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(raw_results_tbl, <span class="at">by =</span> <span class="st">"ASV (Sequence)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Genus (BLASTn)"</span> <span class="ot">=</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_split_fixed</span>(<span class="at">string =</span> .<span class="sc">$</span><span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pattern =</span> <span class="st">" "</span>, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">n =</span> <span class="dv">2</span>)[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ASV (Sequence)"</span>, </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Family (BLASTn)"</span>, </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Genus (BLASTn)"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the taxonomy to the main table</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>raw_results_tax_tbl <span class="ot">&lt;-</span> </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  raw_results_tbl <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(blast_tax_less, </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ASV (Sequence)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ASV header"</span>, <span class="st">"ASV (Sequence)"</span>, <span class="st">"Curated ID"</span>, </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Final ID (BLASTn)"</span>, <span class="st">"BLASTn pseudo-score"</span>, </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Class (BLASTn)"</span>, <span class="st">"Family (BLASTn)"</span>, </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Genus (BLASTn)"</span>, <span class="st">"Curated Order (BLASTn)"</span>, </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Sample"</span>, <span class="st">"Unique_File_name"</span>, <span class="st">"OTU"</span>, </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Abundance"</span>, <span class="st">"Obs. Curadoria"</span>, <span class="st">"Read origin"</span>, </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Primer expected length"</span>, <span class="st">"ASV Size (pb)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"Order (BLASTn)"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Curated Order (BLASTn)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="metadata-integration" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="metadata-integration"><span class="header-section-number">2.3</span> Metadata integration</h3>
<p>Finally, we create a metadata table containing information about each sample (such as location, date, and filter type) and join it with the sequencing data. This information was not included in the initial bioinformatics metabarcoding pipeline input, so it’s being explicitly incorporated at this stage.</p>
<ul>
<li><p>Creating the metadata dataframe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectors with information for each sample</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Sample <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"L1_nov_dec_20_mi"</span>, <span class="st">"L2_nov20"</span>, <span class="st">"L2_dez20"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"L1_out21"</span>, <span class="st">"L2_out21"</span>, <span class="st">"L3_out21"</span>, <span class="st">"L4_out21"</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"L1_nov21"</span>, <span class="st">"L2_nov21"</span>, <span class="st">"L3_nov21"</span>, <span class="st">"L4_nov21"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"STX_L1_nov21"</span>, <span class="st">"STX_L2_nov21"</span>, <span class="st">"STX_L3_nov21"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"STX_L4_nov21"</span>, <span class="st">"L1_jan22"</span>, <span class="st">"L2_jan22"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"L3_jan22"</span>, <span class="st">"L4_jan22"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>Expedition <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"November and December 2020"</span>, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"November 2020"</span>, <span class="st">"December 2020"</span>, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"October 2021"</span>, <span class="st">"October 2021"</span>, </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"October 2021"</span>, <span class="st">"October 2021"</span>, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"November 2021"</span>, <span class="st">"November 2021"</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"November 2021"</span>, <span class="st">"November 2021"</span>, </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"November 2021"</span>, <span class="st">"November 2021"</span>, </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"November 2021"</span>, <span class="st">"November 2021"</span>, </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"January 2022"</span>, <span class="st">"January 2022"</span>, </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"January 2022"</span>, <span class="st">"January 2022"</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>Year <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2020"</span>, <span class="st">"2020"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2022"</span>, <span class="st">"2022"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">"2022"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>Site <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"P1"</span>, <span class="st">"P2"</span>, <span class="st">"P2"</span>, <span class="st">"P3"</span>, <span class="st">"P4"</span>, <span class="st">"P2"</span>, <span class="st">"P1"</span>, <span class="st">"P3"</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>          <span class="st">"P4"</span>, <span class="st">"P2"</span>, <span class="st">"P1"</span>, <span class="st">"P3"</span>, <span class="st">"P4"</span>, <span class="st">"P2"</span>, <span class="st">"P1"</span>, <span class="st">"P3"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>          <span class="st">"P4"</span>, <span class="st">"P2"</span>, <span class="st">"P1"</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>Filter <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"Sterivex"</span>,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Sterivex"</span>, <span class="st">"Sterivex"</span>, <span class="st">"Sterivex"</span>, <span class="st">"MCE"</span>, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">"MCE"</span>, <span class="st">"MCE"</span>, <span class="st">"MCE"</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>Run <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Run2_ago21"</span>, <span class="st">"Run4_out21"</span>, <span class="st">"Run4_out21"</span>, </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Run5_dez21"</span>, <span class="st">"Run5_dez21"</span>, <span class="st">"Run5_dez21"</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Run5_dez21"</span>, <span class="st">"Run5_dez21"</span>, <span class="st">"Run5_dez21"</span>,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Run5_dez21"</span>, <span class="st">"Run5_dez21"</span>, <span class="st">"EM156"</span>, <span class="st">"EM156"</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>         <span class="st">"EM156"</span>, <span class="st">"EM156"</span>, <span class="st">"EM156"</span>, <span class="st">"EM156"</span>, <span class="st">"EM156"</span>, </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>         <span class="st">"EM156"</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>Level <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High"</span>, <span class="st">"High"</span>, <span class="st">"High"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"Low"</span>, <span class="st">"High"</span>, <span class="st">"High"</span>, <span class="st">"High"</span>,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>           <span class="st">"High"</span>)</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine vectors into a tibble</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>metadata_tbl <span class="ot">&lt;-</span> </span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(Run, Sample, Filter, Site, Expedition, Year, Level)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Joining data with metadata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>raw_results_full_tbl <span class="ot">&lt;-</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(raw_results_tax_tbl,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>            metadata_tbl,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"Sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"ASV header"</span>, <span class="st">"ASV (Sequence)"</span>, <span class="st">"Curated ID"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Obs. Curadoria"</span>, <span class="st">"Final ID (BLASTn)"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">"BLASTn pseudo-score"</span>, <span class="st">"Class (BLASTn)"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Family (BLASTn)"</span>,<span class="st">"Genus (BLASTn)"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Order (BLASTn)"</span>, <span class="st">"Sample"</span>, <span class="st">"Unique_File_name"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">"OTU"</span>, <span class="st">"Abundance"</span>, <span class="st">"Read origin"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Primer expected length"</span>, <span class="st">"ASV Size (pb)"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Run"</span>, <span class="st">"Filter"</span>, <span class="st">"Site"</span>, <span class="st">"Expedition"</span>, <span class="st">"Year"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Level"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="manual-corrections" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="manual-corrections"><span class="header-section-number">2.4</span> Manual corrections</h3>
<ul>
<li><p>Correcting taxonomic identifications after curation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update families for specific genera (february 10th 2025)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>raw_results_full_tbl <span class="ot">&lt;-</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  raw_results_full_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Genus (BLASTn)</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Psalidodon"</span>, <span class="st">"Moenkhausia"</span>, <span class="st">"Astyanax"</span>, <span class="st">"Hemigrammus"</span>, <span class="st">"Oligosarcus"</span>), <span class="st">"Acestrorhamphidae"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Genus (BLASTn)</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">"Piabina"</span>, <span class="st">"Stevardiidae"</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="data-filtering" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="data-filtering"><span class="header-section-number">2.5</span> Data filtering</h3>
<ul>
<li><p>We remove reads outside the expected size range, NA identifications, potential contaminants from birds and mammals with low scores, and data from negative controls. Only data generated with MCE filter are used for downstream analyses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>curated_full_tbl <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  raw_results_full_tbl <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Filter <span class="sc">==</span> <span class="st">"MCE"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Primer expected length</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">"out of range"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">"NA"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Mammalia"</span>, <span class="st">"Aves"</span>) <span class="sc">&amp;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">BLASTn pseudo-score</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">98</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>Sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"EM113_NEGPCR1"</span>, <span class="st">"EM135c4c5_NEGPCR1"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"EM135c4c5_NEGPCR2"</span>,<span class="st">"EM149_NEGPCR1"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"EM149_NEGPCR2"</span>, <span class="st">"EM156_NegPCR1"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"S724_NEGPCR1"</span>, <span class="st">"br_jan_22"</span>, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"br_nov21"</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Obs. Curadoria</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">"Possible contamination"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(curated_full_tbl, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(tbl_path, <span class="st">"/curated_full_tbl"</span>, <span class="st">"-"</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>curated_full_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 529 × 23
   `ASV header`   `ASV (Sequence)`                 `Curated ID` `Obs. Curadoria`
   &lt;chr&gt;          &lt;chr&gt;                            &lt;chr&gt;        &lt;chr&gt;           
 1 &gt;ASV_471_167bp CACCGCGGTTATACGAGAGGCCCAAGTTGAC… Coptodon re… True detection  
 2 &gt;ASV_471_167bp CACCGCGGTTATACGAGAGGCCCAAGTTGAC… Coptodon re… True detection  
 3 &gt;ASV_472_167bp TTTCGCAGCTTTCGTGGGGTCGGAAATATAA… Coptodon re… True detection  
 4 &gt;ASV_471_167bp CACCGCGGTTATACGAGAGGCCCAAGTTGAC… Coptodon re… True detection  
 5 &gt;ASV_472_167bp TTTCGCAGCTTTCGTGGGGTCGGAAATATAA… Coptodon re… True detection  
 6 &gt;ASV_472_167bp TTTCGCAGCTTTCGTGGGGTCGGAAATATAA… Coptodon re… True detection  
 7 &gt;ASV_471_167bp CACCGCGGTTATACGAGAGGCCCAAGTTGAC… Coptodon re… True detection  
 8 &gt;ASV_56_175bp  CACCGCGGTTACACGTGAAGGCTCAAGTTGA… Moenkhausia… True detection  
 9 &gt;ASV_57_175bp  TTTCTCAGCTTTCGTGGATCGAGAGGTTCTA… Moenkhausia… True detection  
10 &gt;ASV_473_167bp CACCGCGGTTATACGAGAGACCCCAGTTGAT… Hoplias int… True detection  
# ℹ 519 more rows
# ℹ 19 more variables: `Final ID (BLASTn)` &lt;chr&gt;, `BLASTn pseudo-score` &lt;dbl&gt;,
#   `Class (BLASTn)` &lt;chr&gt;, `Family (BLASTn)` &lt;chr&gt;, `Genus (BLASTn)` &lt;chr&gt;,
#   `Order (BLASTn)` &lt;chr&gt;, Sample &lt;chr&gt;, Unique_File_name &lt;chr&gt;, OTU &lt;dbl&gt;,
#   Abundance &lt;dbl&gt;, `Read origin` &lt;chr&gt;, `Primer expected length` &lt;chr&gt;,
#   `ASV Size (pb)` &lt;dbl&gt;, Run &lt;chr&gt;, Filter &lt;chr&gt;, Site &lt;chr&gt;,
#   Expedition &lt;chr&gt;, Year &lt;chr&gt;, Level &lt;chr&gt;</code></pre>
</div>
</div></li>
</ul>
<section id="analysis-of-removed-data" class="level4" data-number="2.5.1">
<h4 data-number="2.5.1" class="anchored" data-anchor-id="analysis-of-removed-data"><span class="header-section-number">2.5.1</span> Analysis of removed data</h4>
<ul>
<li><p>Overview of informations about the data removed from the main dataset: reads outside the range, NA IDs, possible contaminations, non-Actinopteri IDs, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All MCE ASVs filtered from dataset </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>filt_asvs <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setdiff</span>(raw_results_full_tbl,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      curated_full_tbl) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Filter) <span class="sc">%in%</span> <span class="st">"Sterivex"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"NA"</span>, <span class="cn">NA</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Infos about classes of ASVs filtered</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>filt_stats_class <span class="ot">&lt;-</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  filt_asvs <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV (Sequence)</span><span class="st">`</span>)),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU)),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>)))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Infos about fish ASVs filtered</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>filt_stats_fish <span class="ot">&lt;-</span> </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  filt_asvs <span class="sc">%&gt;%</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"Actinopteri"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV (Sequence)</span><span class="st">`</span>)),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU)),</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>)))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Infos about samples filtered from dataset</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>filt_stats_sample <span class="ot">&lt;-</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  filt_asvs <span class="sc">%&gt;%</span> </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span> </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV (Sequence)</span><span class="st">`</span>)),</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU)),</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>)))</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Infos about Curated IDs filtered from dataset</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>filt_stats_IDs_all <span class="ot">&lt;-</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  filt_asvs <span class="sc">%&gt;%</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"Family"</span> <span class="ot">=</span><span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Class"</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>), </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                        <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Samples"</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">unique</span>(Sample), </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                        <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Reasons"</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">c</span>(</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>))) <span class="st">"ID is NA"</span>,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">any</span>(<span class="st">`</span><span class="at">Obs. Curadoria</span><span class="st">`</span> <span class="sc">%in%</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Possible contamination"</span>))</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Contamination"</span>,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">any</span>(<span class="st">`</span><span class="at">Primer expected length</span><span class="st">`</span> <span class="sc">%in%</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"out of range"</span>))</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Out of range"</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">any</span>((<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">"Actinopteri"</span> <span class="sc">&amp;</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>)))) </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">"Class:"</span>, <span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>), </span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(Sample, <span class="st">"PCR"</span>)))</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">"PCR control"</span>,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(Sample, <span class="st">"^br_"</span>)))</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Extraction control"</span> )),</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">collapse =</span> <span class="st">", "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>         Reads,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>         Samples,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>         Reasons,</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>         Class,</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>         Family) <span class="sc">%&gt;%</span> </span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Reads)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Curated ID', 'Final ID (BLASTn)'. You can
override using the `.groups` argument.</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="table-s4" class="level4" data-number="2.5.2">
<h4 data-number="2.5.2" class="anchored" data-anchor-id="table-s4"><span class="header-section-number">2.5.2</span> Table S4</h4>
<ul>
<li><p><strong>Table of removed taxonomic identifications.</strong> Each row corresponds to one taxon in a given sample and summarizes the information that led to its exclusion from the final dataset. Columns include the taxonomic class (Class), family (Family), taxon name (Taxa), number of reads (Reads), relative read abundance (% RRA), and the sample of origin (Sample). Since different ASVs can be grouped under the same taxon within a sample, the ‘Reason’ column specifies why that taxon was removed (e.g., detected in controls – Contamination or PCR control/Filtration control; amplicon length outside the expected range – Out of range; unidentified ASVs – ID is NA; or belonging to a non-Actinopterygii class such as Mammalia or Aves).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Infos about IDs and samples</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Retriving total sample abundances</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>sample_abd <span class="ot">&lt;-</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  raw_results_full_tbl <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Filter) <span class="sc">%in%</span> <span class="st">"Sterivex"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_abundance =</span> <span class="fu">sum</span>(Abundance, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>filt_stats_IDs_samples <span class="ot">&lt;-</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  filt_asvs <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>, Sample) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"Family"</span> <span class="ot">=</span><span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Class"</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Reasons"</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">unique</span>(<span class="fu">c</span>(</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>))) <span class="st">"ID is NA"</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">any</span>(<span class="st">`</span><span class="at">Obs. Curadoria</span><span class="st">`</span> <span class="sc">%in%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Possible contamination"</span>))</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Contamination"</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">any</span>(<span class="st">`</span><span class="at">Primer expected length</span><span class="st">`</span> <span class="sc">%in%</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"out of range"</span>))</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Out of range"</span>,</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">any</span>((<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span> <span class="sc">!=</span> <span class="st">"Actinopteri"</span> <span class="sc">&amp;</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>))))</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste</span>(<span class="st">"Class:"</span>, <span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>),</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(Sample, <span class="st">"PCR"</span>)))</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"PCR control"</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">str_detect</span>(Sample, <span class="st">"^br_"</span>)))</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Extraction control"</span> )),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">collapse =</span> <span class="st">", "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sample_abd, <span class="at">by =</span> <span class="st">"Sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"RRA %"</span> <span class="ot">=</span> <span class="fu">round</span>(Reads <span class="sc">/</span> total_abundance <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                         <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>         Reads,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">RRA %</span><span class="st">`</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>         Sample,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>         Reasons,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>         Class,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>         Family) <span class="sc">%&gt;%</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">RRA %</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Curated ID', 'Final ID (BLASTn)',
'Sample'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting table for the paper</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(filt_stats_IDs_samples, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(tbl_path, <span class="st">"/filt_stats_summary"</span>, <span class="st">"-"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>filt_stats_IDs_samples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 397 × 8
   `Curated ID`   `Final ID (BLASTn)`  Reads `RRA %` Sample Reasons Class Family
   &lt;chr&gt;          &lt;chr&gt;                &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; 
 1 Canis familia… Canis lupus famili…      1   100   EM113… "Class… Mamm… Canid…
 2 Coptodon rend… Tilapia rendalli    494025    95.8 L4_no… ""      Acti… Cichl…
 3 Coptodon rend… Tilapia rendalli     43716    88.1 L3_no… ""      Acti… Cichl…
 4 Synbranchus    Synbranchus sp.       2424    77.9 EM149… "Conta… Acti… Synbr…
 5 Coptodon rend… Tilapia rendalli    288365    77.7 L3_ou… ""      Acti… Cichl…
 6 Moenkhausia c… Moenkhausia costae  263677    73.8 L2_de… "Out o… Acti… Acest…
 7 Coptodon rend… Tilapia rendalli     47443    71.4 L1_no… ""      Acti… Cichl…
 8 Coptodon rend… Tilapia rendalli    127099    69   L2_no… "Out o… Acti… Cichl…
 9 Homo sapiens   Homo sapiens            21    65.6 L4_ja… "Class… Mamm… Homin…
10 Coptodon rend… Tilapia rendalli    342215    64.5 L2_ou… ""      Acti… Cichl…
# ℹ 387 more rows</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="figure-s2" class="level4" data-number="2.5.3">
<h4 data-number="2.5.3" class="anchored" data-anchor-id="figure-s2"><span class="header-section-number">2.5.3</span> Figure S2</h4>
<ul>
<li><p><strong>Tile plot of removed sequences.</strong> The plot illustrates the taxonomic composition of sequences removed during the filtering process. The X-axis represents samples, grouped by category (filtration control, PCR control, and environmental sample), and the Y-axis shows the taxonomic identifications of sequences excluded from the final dataset. Sequences detected in controls were discarded, as well as those not meeting quality or taxonomic filtering criteria (e.g., unidentified, out-of-range amplicon length, non-Actinopterygii, or potential contaminations).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample levels for plot </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sample_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"br_nov21"</span>, <span class="st">"br_jan_22"</span>, <span class="st">"EM135c4c5_NEGPCR1"</span>, <span class="st">"EM135c4c5_NEGPCR2"</span>, <span class="st">"EM149_NEGPCR1"</span>, <span class="st">"EM149_NEGPCR2"</span>, <span class="st">"EM113_NEGPCR1"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"EM156_NegPCR1"</span>, <span class="st">"S724_NEGPCR1"</span>, <span class="st">"L1_nov_dec_20_mi"</span>, <span class="st">"L2_nov20"</span>, <span class="st">"L2_dez20"</span>, <span class="st">"L1_out21"</span>, <span class="st">"L2_out21"</span>, <span class="st">"L3_out21"</span>, <span class="st">"L1_nov21"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"L2_nov21"</span>, <span class="st">"L3_nov21"</span>, <span class="st">"L4_nov21"</span>, <span class="st">"L1_jan22"</span>, <span class="st">"L2_jan22"</span>, <span class="st">"L3_jan22"</span>, <span class="st">"L4_jan22"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample types for plot</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>sample_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Filtering control,</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="st">                  Filtering control"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Curated ID levels</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>id_levels <span class="ot">&lt;-</span> filt_stats_IDs_samples<span class="sc">$</span><span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>filtered_plot <span class="ot">&lt;-</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  filt_stats_IDs_samples <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sample =</span> <span class="fu">factor</span>(Sample, <span class="at">levels =</span> sample_levels)) <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Class =</span> <span class="fu">ifelse</span>(Class <span class="sc">==</span> <span class="st">"class of subphylum of phylum of kingdom of Bacteria"</span>, <span class="st">"(...) Bacteria"</span>, Class)) <span class="sc">%&gt;%</span>    </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"order of subclass of class of subphylum of phylum of kingdom of Bacteria"</span>, <span class="st">"(...) Bacteria"</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                               <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Family =</span> <span class="fu">ifelse</span>(Family <span class="sc">==</span> <span class="st">"family of suborder of order of subclass of class of subphylum of phylum of kingdom of Bacteria"</span>, <span class="st">"(...) Bacteria"</span>, Family)) <span class="sc">%&gt;%</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"genus of subfamily of Trichomycteridae"</span>, <span class="st">"(...) Trichomycteridae"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_type =</span> <span class="fu">case_when</span>(<span class="fu">str_detect</span>(Sample, <span class="st">"^br_"</span>) <span class="sc">~</span> <span class="st">"Filtration</span><span class="sc">\n</span><span class="st"> control"</span>, <span class="fu">str_detect</span>(Sample, <span class="st">"PCR"</span>) <span class="sc">~</span> <span class="st">"PCR control"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Sample"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span><span class="ot">=</span> <span class="fu">factor</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sample,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">`</span><span class="at">RRA %</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(sample_type),</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">rows =</span> <span class="fu">c</span>(<span class="fu">vars</span>(Class)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># vars(Family)),</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">space =</span> <span class="st">"free"</span>,</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.3f%%"</span>, <span class="st">`</span><span class="at">RRA %</span><span class="st">`</span>)),</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous_sequential</span>(<span class="st">"BluGrn"</span>) <span class="sc">+</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#e4e4e4"</span>),</span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">8.5</span>,</span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">8.5</span>,</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>                               <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>,</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>                               <span class="at">hjust =</span> <span class="fl">0.85</span>,</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>                               <span class="at">vjust =</span> <span class="fl">0.85</span>),</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'RRA (%)'</span>,</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Sample"</span>,</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Taxa"</span>)</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> filtered_plot,</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(figs_path, <span class="st">"/filtered_plot"</span>, <span class="st">"-"</span>, </span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>), </span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">35.5</span>,</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>       <span class="co"># width = 30.5,</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">35.5</span>,</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>filtered_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
</section>
</section>
<section id="preliminary-tables" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="preliminary-tables"><span class="header-section-number">3</span> Preliminary tables</h2>
<ul>
<li><p>Creating a table to evaluate the raw data after pipeline processing</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>raw_resume <span class="ot">&lt;-</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  raw_results_full_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abd total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abundancia total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Reads totais"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"RRA by sample"</span> <span class="ot">=</span> (Abundance<span class="sc">/</span><span class="st">`</span><span class="at">Abd total</span><span class="st">`</span>)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total reads"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Reads totais</span><span class="st">`</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total abundance"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Abundancia total</span><span class="st">`</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"RRA"</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">RRA by sample</span><span class="st">`</span>),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV header</span><span class="st">`</span>)),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU)),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Class"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Order"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Order (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Family"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Genus"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Genus (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Curated ID"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<section id="table-s2" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="table-s2"><span class="header-section-number">3.1</span> Table S2</h3>
<ul>
<li><p><strong>Integrative curation summary of Amplicon Sequence Variants (ASVs) before class- and abundance-based filtering.</strong> The table lists all ASVs with their corresponding taxonomic classifications and read abundances (raw counts) prior to curation. Post-filtering, a refined subset of these ASVs was used for downstream analyses (see Methods).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a table to use to evaluate the unfiltered data</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st Longer table</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>dt_all_resume <span class="ot">&lt;-</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  curated_full_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Level, Site, Filter, Year) <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abd total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abundancia total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Reads totais"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Final ID (BLASTn)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Site</span><span class="st">`</span>, </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Level</span><span class="st">`</span>, <span class="st">`</span><span class="at">Filter</span><span class="st">`</span>, <span class="st">`</span><span class="at">Year</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"RRA no periodo"</span> <span class="ot">=</span> (Abundance<span class="sc">/</span><span class="st">`</span><span class="at">Abd total</span><span class="st">`</span>)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Total reads"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Reads totais</span><span class="st">`</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total abundance"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Abundancia total</span><span class="st">`</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"RRA"</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">RRA no periodo</span><span class="st">`</span>),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV header</span><span class="st">`</span>)),</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU)),</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Class"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Order"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Order (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Family"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Genus"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Genus (BLASTn)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() </span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing if RRA was calculated right</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>dt_all_resume <span class="sc">%&gt;%</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( <span class="st">`</span><span class="at">Site</span><span class="st">`</span>, <span class="st">`</span><span class="at">Level</span><span class="st">`</span>, <span class="st">`</span><span class="at">Filter</span><span class="st">`</span>, <span class="st">`</span><span class="at">Year</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_RRA =</span> <span class="fu">sum</span>(RRA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Site', 'Level', 'Filter'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   Site  Level Filter Year  total_RRA
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
 1 P1    High  MCE    2020        100
 2 P1    High  MCE    2022        100
 3 P1    Low   MCE    2021        100
 4 P2    High  MCE    2020        100
 5 P2    High  MCE    2022        100
 6 P2    Low   MCE    2021        100
 7 P3    High  MCE    2022        100
 8 P3    Low   MCE    2021        100
 9 P4    High  MCE    2022        100
10 P4    Low   MCE    2021        100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wider table to evaluate unfiltered data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>wider_dt_all_resume <span class="ot">&lt;-</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    dt_all_resume <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RRA =</span> <span class="fu">round</span>(RRA,<span class="at">digits =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, Level, Year, Filter, <span class="at">col=</span> <span class="st">"Site_Level_Year"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"Class"</span>,<span class="st">"Curated ID"</span>, <span class="st">"Final ID (BLASTn)"</span>, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Total reads"</span>, <span class="st">"Total abundance"</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>              <span class="co"># names_from = Site_Level_Year_Filter,</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> Site_Level_Year,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span>  <span class="fu">c</span>(<span class="st">"RRA"</span>,<span class="st">"ASVs"</span>,<span class="st">"OTUs"</span>,<span class="st">"Reads"</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_glue =</span> <span class="st">"{Site_Level_Year}_{.value}"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">sort</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">"Class"</span>,<span class="st">"Curated ID"</span>,<span class="st">"Final ID (BLASTn)"</span>,<span class="st">"Total reads"</span>, </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Total abundance"</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>           <span class="co">#2020 MCE</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P1_High_2020_MCE_Reads"</span>, <span class="st">"P1_High_2020_MCE_ASVs"</span>, <span class="st">"P1_High_2020_MCE_OTUs"</span>, <span class="st">"P1_High_2020_MCE_RRA"</span>, <span class="st">"P2_High_2020_MCE_Reads"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P2_High_2020_MCE_ASVs"</span>, <span class="st">"P2_High_2020_MCE_OTUs"</span>, <span class="st">"P2_High_2020_MCE_RRA"</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>           <span class="co">#2021 MCE</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P1_Low_2021_MCE_Reads"</span>, <span class="st">"P1_Low_2021_MCE_ASVs"</span>, <span class="st">"P1_Low_2021_MCE_OTUs"</span>, <span class="st">"P1_Low_2021_MCE_RRA"</span>, <span class="st">"P2_Low_2021_MCE_Reads"</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P2_Low_2021_MCE_ASVs"</span>, <span class="st">"P2_Low_2021_MCE_OTUs"</span>, <span class="st">"P2_Low_2021_MCE_RRA"</span>, <span class="st">"P3_Low_2021_MCE_Reads"</span>, <span class="st">"P3_Low_2021_MCE_ASVs"</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P3_Low_2021_MCE_OTUs"</span>, <span class="st">"P3_Low_2021_MCE_RRA"</span>, <span class="st">"P4_Low_2021_MCE_Reads"</span>, <span class="st">"P4_Low_2021_MCE_ASVs"</span>, <span class="st">"P4_Low_2021_MCE_OTUs"</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P4_Low_2021_MCE_RRA"</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>           <span class="co">#2022 MCE</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P1_High_2022_MCE_Reads"</span>, <span class="st">"P1_High_2022_MCE_ASVs"</span>, <span class="st">"P1_High_2022_MCE_OTUs"</span>, <span class="st">"P1_High_2022_MCE_RRA"</span>, <span class="st">"P2_High_2022_MCE_Reads"</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P2_High_2022_MCE_ASVs"</span>, <span class="st">"P2_High_2022_MCE_OTUs"</span>, <span class="st">"P2_High_2022_MCE_RRA"</span>, <span class="st">"P3_High_2022_MCE_Reads"</span>, <span class="st">"P3_High_2022_MCE_ASVs"</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P3_High_2022_MCE_OTUs"</span>, <span class="st">"P3_High_2022_MCE_RRA"</span>, <span class="st">"P4_High_2022_MCE_Reads"</span>, <span class="st">"P4_High_2022_MCE_ASVs"</span>, <span class="st">"P4_High_2022_MCE_OTUs"</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P4_High_2022_MCE_RRA"</span>)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting table for the paper</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(wider_dt_all_resume, </span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(tbl_path, <span class="st">"/wider_dt_all_resume"</span>, <span class="st">"-"</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>wider_dt_all_resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 62 × 45
   Class       `Curated ID`  `Final ID (BLASTn)` `Total reads` `Total abundance`
   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;                       &lt;dbl&gt;             &lt;dbl&gt;
 1 Actinopteri Astyanax bim… Astyanax bimaculat…           153               153
 2 Actinopteri Astyanax lac… Astyanax lacustris          28025             28025
 3 Mammalia    Bos taurus    Bos taurus                   8168              8168
 4 Mammalia    Canis famili… Canis lupus famili…            76                76
 5 Mammalia    Capra hircus  Capra hircus                  168               168
 6 Mammalia    Cavia magna   Cavia magna                  1043              1043
 7 Actinopteri Characidae 1  Planaltina myersi              32                32
 8 Actinopteri Characidium … Characidium sp.                 8                 8
 9 Actinopteri Colossoma ma… Piaractus brachypo…             9                 9
10 Actinopteri Coptodon ren… Coptodon zillii                34           1600284
# ℹ 52 more rows
# ℹ 40 more variables: P1_High_2020_MCE_Reads &lt;dbl&gt;,
#   P1_High_2020_MCE_ASVs &lt;int&gt;, P1_High_2020_MCE_OTUs &lt;int&gt;,
#   P1_High_2020_MCE_RRA &lt;dbl&gt;, P2_High_2020_MCE_Reads &lt;dbl&gt;,
#   P2_High_2020_MCE_ASVs &lt;int&gt;, P2_High_2020_MCE_OTUs &lt;int&gt;,
#   P2_High_2020_MCE_RRA &lt;dbl&gt;, P1_Low_2021_MCE_Reads &lt;dbl&gt;,
#   P1_Low_2021_MCE_ASVs &lt;int&gt;, P1_Low_2021_MCE_OTUs &lt;int&gt;, …</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="table-s5" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="table-s5"><span class="header-section-number">3.2</span> Table S5</h3>
<ul>
<li><p><strong>Table S5. Post-curation and filtering results for retained species.</strong> This table presents the total read abundance per species across all samples (Total abundance), absolute number of reads per species at each sampling point and campaign (Reads), number of ASVs (ASVs) and OTUs (OTUs) assigned to each species, and Relative Read Abundance (RRA). This table reflects the final dataset used for statistical and ecological analyses after integrative curation (see Methods).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the table with data to be used in analysis</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtered data, only Actinopteri and reads &gt;=100</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>filt_tbl <span class="ot">&lt;-</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  curated_full_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">"Actinopteri"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Salmo salar"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, Site, Level, Filter, Year) <span class="sc">%&gt;%</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Reads =</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Reads <span class="sc">&gt;=</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtered and grouped data by Samples</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>grouped_sampled_filt_tbl <span class="ot">&lt;-</span> </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  curated_full_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span> <span class="sc">%in%</span> <span class="st">"Actinopteri"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Salmo salar"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, Sample) <span class="sc">%&gt;%</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Reads =</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Reads <span class="sc">&gt;=</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># creating total abundance by sample</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abd total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculating RRA by Sample</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, Sample) <span class="sc">%&gt;%</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"RRA na amostra"</span> <span class="ot">=</span> (Abundance<span class="sc">/</span><span class="st">`</span><span class="at">Abd total</span><span class="st">`</span><span class="sc">*</span><span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">"Site"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Site),</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Year),</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Expedition"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Expedition),</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Level"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Level),</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Filter"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(Filter),</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Class"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Order"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="st">`</span><span class="at">Order (BLASTn)</span><span class="st">`</span>),</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Family"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>),</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Genus"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="st">`</span><span class="at">Genus (BLASTn)</span><span class="st">`</span>),</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Sample abundance"</span> <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">first</span>(<span class="st">`</span><span class="at">Abd total</span><span class="st">`</span>),</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>          <span class="st">"RRA"</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">RRA na amostra</span><span class="st">`</span>),</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>          <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV header</span><span class="st">`</span>)),</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>          <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Curated ID'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Is RRA correct?</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>grouped_sampled_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_RRA =</span> <span class="fu">sum</span>(RRA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   Sample           total_RRA
   &lt;chr&gt;                &lt;dbl&gt;
 1 L1_jan22               100
 2 L1_nov21               100
 3 L1_nov_dec_20_mi       100
 4 L1_out21               100
 5 L2_dez20               100
 6 L2_jan22               100
 7 L2_nov20               100
 8 L2_nov21               100
 9 L2_out21               100
10 L3_nov21               100
11 L3_out21               100
12 L4_nov21               100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtered and grouped data by Year, Site and Filter</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A tabela wider precisa dessas informacoes separadamente</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>grouped_filt_tbl <span class="ot">&lt;-</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># creating total abundance by period</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Level, Site, Filter, Year) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abd total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># creating total abundance by Curated ID</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Abundancia total"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculating RRA by period</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, Site, Level, Filter, Year) <span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"RRA no periodo"</span> <span class="ot">=</span> (Abundance<span class="sc">/</span><span class="st">`</span><span class="at">Abd total</span><span class="st">`</span>)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Curated ID"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Class"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Class (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Order"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Order (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Family"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Family (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Genus"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Genus (BLASTn)</span><span class="st">`</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance),</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Period abundance"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Abd total</span><span class="st">`</span>,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Total abundance"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Abundancia total</span><span class="st">`</span>, </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>          <span class="st">"RRA"</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">RRA no periodo</span><span class="st">`</span>),</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>          <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">ASV header</span><span class="st">`</span>)),</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>          <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(OTU))) <span class="sc">%&gt;%</span> </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Is RRA correct?</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Site, Level, Filter, Year) <span class="sc">%&gt;%</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_RRA =</span> <span class="fu">sum</span>(RRA, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Site', 'Level', 'Filter'. You can override
using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  Site  Level Filter Year  total_RRA
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
1 P1    High  MCE    2020        100
2 P1    Low   MCE    2021        100
3 P2    High  MCE    2020        100
4 P2    Low   MCE    2021        100
5 P3    High  MCE    2022        100
6 P3    Low   MCE    2021        100
7 P4    High  MCE    2022        100
8 P4    Low   MCE    2021        100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela wider com os dados filtrados</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>wider_filt_tbl <span class="ot">&lt;-</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RRA =</span> <span class="fu">round</span>(RRA,<span class="at">digits =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, Level, Year, <span class="at">col=</span> <span class="st">"Site_Level_Year"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"Curated ID"</span>, <span class="st">"Total abundance"</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> Site_Level_Year,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span>  <span class="fu">c</span>(<span class="st">"RRA"</span>,<span class="st">"ASVs"</span>,<span class="st">"OTUs"</span>,<span class="st">"Reads"</span>),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_glue =</span> <span class="st">"{Site_Level_Year}_{.value}"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">sort</span>(<span class="fu">colnames</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">"Curated ID"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Total abundance"</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>           <span class="co">#2020 MCE</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P1_High_2020_Reads"</span>, <span class="st">"P1_High_2020_ASVs"</span>, <span class="st">"P1_High_2020_OTUs"</span>, <span class="st">"P1_High_2020_RRA"</span>, <span class="st">"P2_High_2020_Reads"</span>, <span class="st">"P2_High_2020_ASVs"</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P2_High_2020_OTUs"</span>, <span class="st">"P2_High_2020_RRA"</span>,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>           <span class="co">#2021 MCE</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P1_Low_2021_Reads"</span>, <span class="st">"P1_Low_2021_ASVs"</span>, <span class="st">"P1_Low_2021_OTUs"</span>, <span class="st">"P1_Low_2021_RRA"</span>, <span class="st">"P2_Low_2021_Reads"</span>, <span class="st">"P2_Low_2021_ASVs"</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P2_Low_2021_OTUs"</span>, <span class="st">"P2_Low_2021_RRA"</span>, <span class="st">"P3_Low_2021_Reads"</span>, <span class="st">"P3_Low_2021_ASVs"</span>, <span class="st">"P3_Low_2021_OTUs"</span>, <span class="st">"P3_Low_2021_RRA"</span>,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P4_Low_2021_Reads"</span>, <span class="st">"P4_Low_2021_ASVs"</span>, <span class="st">"P4_Low_2021_OTUs"</span>, <span class="st">"P4_Low_2021_RRA"</span>,</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>           <span class="co">#2022 MCE</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P3_High_2022_Reads"</span>, <span class="st">"P3_High_2022_ASVs"</span>, <span class="st">"P3_High_2022_OTUs"</span>, <span class="st">"P3_High_2022_RRA"</span>, <span class="st">"P4_High_2022_Reads"</span>, <span class="st">"P4_High_2022_ASVs"</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>           <span class="st">"P4_High_2022_OTUs"</span>, <span class="st">"P4_High_2022_RRA"</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting table for the paper</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(wider_filt_tbl, </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(tbl_path, <span class="st">"/wider_dt_filt"</span>, <span class="st">"-"</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>wider_filt_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 34
   `Curated ID`           `Total abundance` P1_High_2020_Reads P1_High_2020_ASVs
   &lt;chr&gt;                              &lt;dbl&gt;              &lt;dbl&gt;             &lt;int&gt;
 1 Astyanax lacustris                 27792                 NA                NA
 2 Coptodon rendalli                1600284              18615                 2
 3 Hemigrammus marginatus             66126                 NA                NA
 4 Hoplias intermedius               473065              19691                 1
 5 Hoplias malabaricus                 2256                 NA                NA
 6 Leporinus sp.                       6666                 NA                NA
 7 Moenkhausia costae                267296               2457                 1
 8 Myleus micans                        137                 NA                NA
 9 Oreochromis niloticus              24430                 NA                NA
10 Pimelodus sp.                        318                 NA                NA
11 Poecilia reticulata                 3616                 NA                NA
12 Psalidodon sp.                    304379                 NA                NA
13 Rhamdia quelen                     17175                238                 1
14 Schizodon knerii                   31426                 NA                NA
15 Serrasalmus brandtii                5745                 NA                NA
16 Trichomycterus sp.                   262                 NA                NA
# ℹ 30 more variables: P1_High_2020_OTUs &lt;int&gt;, P1_High_2020_RRA &lt;dbl&gt;,
#   P2_High_2020_Reads &lt;dbl&gt;, P2_High_2020_ASVs &lt;int&gt;, P2_High_2020_OTUs &lt;int&gt;,
#   P2_High_2020_RRA &lt;dbl&gt;, P1_Low_2021_Reads &lt;dbl&gt;, P1_Low_2021_ASVs &lt;int&gt;,
#   P1_Low_2021_OTUs &lt;int&gt;, P1_Low_2021_RRA &lt;dbl&gt;, P2_Low_2021_Reads &lt;dbl&gt;,
#   P2_Low_2021_ASVs &lt;int&gt;, P2_Low_2021_OTUs &lt;int&gt;, P2_Low_2021_RRA &lt;dbl&gt;,
#   P3_Low_2021_Reads &lt;dbl&gt;, P3_Low_2021_ASVs &lt;int&gt;, P3_Low_2021_OTUs &lt;int&gt;,
#   P3_Low_2021_RRA &lt;dbl&gt;, P4_Low_2021_Reads &lt;dbl&gt;, P4_Low_2021_ASVs &lt;int&gt;, …</code></pre>
</div>
</div></li>
</ul>
</section>
</section>
<section id="initial-data-assesment" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="initial-data-assesment"><span class="header-section-number">4</span> Initial data assesment</h2>
<section id="number-of-reads-by-sample-after-sequencing" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="number-of-reads-by-sample-after-sequencing"><span class="header-section-number">4.1</span> Number of Reads by sample after sequencing</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>seq_read_counts <span class="ot">&lt;-</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"/home/gabriel/projetos/old/peixes-eDNA/analises/dez_23/runs_2_4_5_EM156/results/LI-reads_and_seqs_counts2024-01-08.xlsx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only MCE samples</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Sample <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"L1_nov_dec_20_mi"</span>, <span class="st">"L2_nov20"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"L2_dez20"</span>, <span class="st">"L1_out21"</span>, <span class="st">"L2_out21"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"L3_out21"</span>, <span class="st">"L4_out21"</span>, <span class="st">"L1_nov21"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"L2_nov21"</span>, <span class="st">"L3_nov21"</span>, <span class="st">"L1_jan22"</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"L2_jan22"</span>, <span class="st">"L3_jan22"</span>, <span class="st">"L4_jan22"</span>,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"br_jan_22"</span>,<span class="st">"EM113_NEGPCR1"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"EM135c4c5_NEGPCR1"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"EM135c4c5_NEGPCR2"</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"EM149_NEGPCR1"</span>,<span class="st">"EM149_NEGPCR2"</span>,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"EM156_NegPCR1"</span>, <span class="st">"S724_NEGPCR1"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">Raw reads (pairs)</span><span class="st">`</span>))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>seq_read_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `Total reads`
          &lt;dbl&gt;
1       3295524</code></pre>
</div>
</div>
</section>
<section id="number-of-reads-after-post-pipeline-and-filtering" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="number-of-reads-after-post-pipeline-and-filtering"><span class="header-section-number">4.2</span> Number of reads after post-pipeline and filtering</h3>
<ul>
<li>This section computes the total read count per sample that remained after data processing and filtering. This final, high-quality dataset was used for all downstream analyses. The filtering criteria included: exclusion of NA values, restriction to the Actinopteri group, and a minimum threshold of 100 reads per curated taxonomic ID</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>filt_raw_reads <span class="ot">&lt;-</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  grouped_sampled_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(`Curated ID`) %&gt;% # grouped_filt_tbl</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span> <span class="co"># grouped_filt_tbl</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_abd_filt =</span> <span class="fu">sum</span>(Reads))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(filt_raw_reads<span class="sc">$</span>total_abd_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2830338</code></pre>
</div>
</div>
</section>
<section id="ids-metrics-pre-pipeline-and-filtering" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="ids-metrics-pre-pipeline-and-filtering"><span class="header-section-number">4.3</span> IDs metrics pre-pipeline and filtering</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Total reads in ASVs, OTUs, Orders, Families, Genus, Species and Nspecies for raw data</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>raw_stats <span class="ot">&lt;-</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  raw_resume <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">sum</span>(ASVs),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">sum</span>(OTUs),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Orders"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Order)),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Family)),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Genera"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Genus)),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Species"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>[<span class="fu">grepl</span>(<span class="st">"^[A-Za-z]+</span><span class="sc">\\</span><span class="st">s[A-Za-z]+$"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sp</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)])),</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nspecies"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">-</span> Species</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ids-metrics-post-pipeline-and-filtering" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="ids-metrics-post-pipeline-and-filtering"><span class="header-section-number">4.4</span> IDs metrics post-pipeline and filtering</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>grouped_filt_stats <span class="ot">&lt;-</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Class) <span class="sc">%&gt;%</span> <span class="co"># Grouped by Class</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(Order) %&gt;% # Grouped by Order</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(Family) %&gt;% # Grouped by Family</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(Genus) %&gt;% # Grouped by Genus</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(`Curated ID`) %&gt;% # Grouped by Species</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">sum</span>(ASVs),</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">sum</span>(OTUs),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Orders"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Order</span><span class="st">`</span>)),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Family</span><span class="st">`</span>)),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Genera"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Genus</span><span class="st">`</span>)),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Species"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>[<span class="fu">grepl</span>(<span class="st">"^[A-Za-z]+</span><span class="sc">\\</span><span class="st">s[A-Za-z]+$"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sp</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)])),</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nspecies"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">-</span> Species</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="table-s6" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="table-s6"><span class="header-section-number">4.5</span> Table S6</h3>
<ul>
<li><p><strong>Table S6. Observed alpha-diversity values per sampling site and mean diversity per water-level period.</strong> Observed alpha-diversity values per sampling site and mean diversity per water-level period. Alpha-diversity (Observed index) across sampling sites, showing raw values for each location and mean diversity per water-level period. The Observed index represents the total number of distinct species detected in each sample.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean and SD of alpha-diversity</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>grouped_filt_site <span class="ot">&lt;-</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Level, Site) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Diversity"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Level, Site, Diversity) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Level) <span class="sc">%&gt;%</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean"</span> <span class="ot">=</span> <span class="fu">mean</span>(Diversity),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SD"</span> <span class="ot">=</span> <span class="fu">sd</span>(Diversity))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting table for the paper</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(grouped_filt_site, </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">paste0</span>(tbl_path, <span class="st">"/grouped_filt_site"</span>, <span class="st">"-"</span>,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>grouped_filt_site</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
# Groups:   Level [2]
  Level Site  Diversity  Mean    SD
  &lt;chr&gt; &lt;chr&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1 High  P2           10  4.75  3.59
2 Low   P2            9  8     2.16
3 Low   P3           10  8     2.16
4 Low   P4            8  8     2.16
5 High  P1            4  4.75  3.59
6 Low   P1            5  8     2.16
7 High  P3            3  4.75  3.59
8 High  P4            2  4.75  3.59</code></pre>
</div>
</div></li>
</ul>
</section>
</section>
<section id="exploratory-data-assesment" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="exploratory-data-assesment"><span class="header-section-number">5</span> Exploratory data assesment</h2>
<section id="track-the-evolution-of-read-counts" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="track-the-evolution-of-read-counts"><span class="header-section-number">5.1</span> Track the evolution of read counts</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Track the evolution of read counts for each sample across filtering steps</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>raw_results_reads <span class="ot">&lt;-</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  raw_results_tbl <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Raw reads</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>pre_filt_reads <span class="ot">&lt;-</span> </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  curated_full_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>filt_reads <span class="ot">&lt;-</span> </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  filt_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample) <span class="sc">%&gt;%</span> </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Filt reads</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(Abundance))</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>evol_reads <span class="ot">&lt;-</span> </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  raw_results_reads <span class="sc">%&gt;%</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pre_filt_reads, <span class="at">by =</span> <span class="st">"Sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(filt_reads, <span class="at">by =</span> <span class="st">"Sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Raw reads</span><span class="st">`</span>, <span class="st">`</span><span class="at">Filt reads</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample, <span class="st">`</span><span class="at">Raw reads</span><span class="st">`</span>, <span class="st">`</span><span class="at">Filt reads</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="listing-identifications-outside-the-species-level" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="listing-identifications-outside-the-species-level"><span class="header-section-number">5.2</span> Listing identifications outside the species level</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify ASVs that were not identified to the species level (genus + epithet)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>spp_level <span class="ot">&lt;-</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Species"</span> <span class="ot">=</span> <span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>[<span class="fu">grepl</span>(<span class="st">"^[A-Za-z]+</span><span class="sc">\\</span><span class="st">s[A-Za-z]+$"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">&amp;</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sp</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)]))</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>nspp_level <span class="ot">&lt;-</span> </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Nspecies"</span> <span class="ot">=</span> <span class="fu">setdiff</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>), spp_level<span class="sc">$</span>Species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="table-2" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="table-2"><span class="header-section-number">5.3</span> Table 2</h3>
<ul>
<li><p><strong>Table 2. Taxa detected by eDNA metabarcoding.</strong> Taxa detection after integrative curation, showing taxonomic assignment and corresponding absolute read abundance, ASVs, and OTUs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group final filtered data by curated taxonomic identification</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>id_level <span class="ot">&lt;-</span> grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">"Order"</span> <span class="ot">=</span> Order,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Family"</span> <span class="ot">=</span> Family,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Genus"</span> <span class="ot">=</span> Genus,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Curated identification"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">sum</span>(ASVs),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">sum</span>(OTUs)) <span class="sc">%&gt;%</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"Order"</span>, <span class="st">"Family"</span>, <span class="st">"Genus"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Curated identification"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Reads"</span>, <span class="st">"ASVs"</span>,<span class="st">"OTUs"</span>) </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting table for the paper</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(id_level, <span class="fu">paste0</span>(tbl_path, <span class="st">"/id_level_tbl"</span>, <span class="st">"-"</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>id_level</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 7
   Order              Family     Genus Curated identificati…¹  Reads  ASVs  OTUs
   &lt;chr&gt;              &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
 1 Characiformes      Acestrorh… Asty… Astyanax lacustris     2.78e4    16    14
 2 Cichliformes       Cichlidae  Copt… Coptodon rendalli      1.60e6    74    20
 3 Characiformes      Acestrorh… Hemi… Hemigrammus marginatus 6.61e4     6     2
 4 Characiformes      Erythrini… Hopl… Hoplias intermedius    4.73e5    31    15
 5 Characiformes      Erythrini… Hopl… Hoplias malabaricus    2.26e3     2     2
 6 Characiformes      Anostomid… Lepo… Leporinus sp.          6.67e3    13    11
 7 Characiformes      Acestrorh… Moen… Moenkhausia costae     2.67e5    28     5
 8 Characiformes      Serrasalm… Myle… Myleus micans          1.37e2     2     2
 9 Cichliformes       Cichlidae  Oreo… Oreochromis niloticus  2.44e4    20    18
10 Siluriformes       Pimelodid… Pime… Pimelodus sp.          3.18e2    13    12
11 Cyprinodontiformes Poeciliid… Poec… Poecilia reticulata    3.62e3     8     8
12 Characiformes      Acestrorh… Psal… Psalidodon sp.         3.04e5    33    13
13 Siluriformes       Pimelodid… Rham… Rhamdia quelen         1.72e4    11    11
14 Characiformes      Anostomid… Schi… Schizodon knerii       3.14e4    10     2
15 Characiformes      Serrasalm… Serr… Serrasalmus brandtii   5.75e3     2     2
16 Siluriformes       Trichomyc… Tric… Trichomycterus sp.     2.62e2     2     2
# ℹ abbreviated name: ¹​`Curated identification`</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="summarizing-final-data-by-class" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="summarizing-final-data-by-class"><span class="header-section-number">5.4</span> Summarizing final data by class</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize final data at the Class level</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>class_Level <span class="ot">&lt;-</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads), </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">sum</span>(ASVs),</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">sum</span>(OTUs),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Orders"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Order)),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Family)),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Genera"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Genus)),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Identifications"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)),</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Species"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>[<span class="fu">grepl</span>(<span class="st">"^[A-Za-z]+</span><span class="sc">\\</span><span class="st">s[A-Za-z]+$"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">&amp;</span> </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>                                               <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sp</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)])), </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nspecies"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">-</span> Species) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="table-s3" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="table-s3"><span class="header-section-number">5.5</span> Table S3</h3>
<ul>
<li><p><strong>Table S3. Taxonomic resolution across orders.</strong> Post-curation taxonomic summary for each order, including total read abundance, number of ASVs and OTUs, and counts of assigned families, genera, and species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize final data at the Order level</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>order_level <span class="ot">&lt;-</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Filter <span class="sc">%in%</span> <span class="st">"MCE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Order) <span class="sc">%&gt;%</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Order"</span> <span class="ot">=</span> Order,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">sum</span>(ASVs),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">sum</span>(OTUs),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Families"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Family)),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Genera"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Genus)),</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Identifications"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)),</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Species"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>[<span class="fu">grepl</span>(<span class="st">"^[A-Za-z]+</span><span class="sc">\\</span><span class="st">s[A-Za-z]+$"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sp</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)])),</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nspecies"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">-</span> Species</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting table for the paper</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(order_level, <span class="fu">paste0</span>(tbl_path, </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"/order_level_tbl"</span>, <span class="st">"-"</span>,</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">Sys.Date</span>(), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>order_level</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 9
  Order        `Total reads`  ASVs  OTUs Families Genera Identifications Species
  &lt;chr&gt;                &lt;dbl&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;  &lt;int&gt;           &lt;int&gt;   &lt;int&gt;
1 Characiform…       1184888   143    68        4      9              10       8
2 Cichliformes       1624714    94    38        1      2               2       2
3 Cyprinodont…          3616     8     8        1      1               1       1
4 Siluriformes         17755    26    25        2      3               3       1
# ℹ 1 more variable: Nspecies &lt;int&gt;</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="summarizing-final-data-by-family" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="summarizing-final-data-by-family"><span class="header-section-number">5.6</span> Summarizing final data by family</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize final data at the Family level</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>family_level <span class="ot">&lt;-</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Filter <span class="sc">%in%</span> <span class="st">"MCE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Family) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Order"</span> <span class="ot">=</span> Order,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads), </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ASVs"</span> <span class="ot">=</span> <span class="fu">sum</span>(ASVs),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OTUs"</span> <span class="ot">=</span> <span class="fu">sum</span>(OTUs),</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Genera"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(Genus)),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Identifications"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)),</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Species"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>[<span class="fu">grepl</span>(<span class="st">"^[A-Za-z]+</span><span class="sc">\\</span><span class="st">s[A-Za-z]+$"</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"sp</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)])),</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Nspecies"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">-</span> Species</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summarizing-total-reads-by-sample" class="level3" data-number="5.7">
<h3 data-number="5.7" class="anchored" data-anchor-id="summarizing-total-reads-by-sample"><span class="header-section-number">5.7</span> Summarizing total reads by sample</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize total reads by sample, site, and filter type</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>grouped_by_Sample <span class="ot">&lt;-</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample, Filter, Reads, Site) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Filter,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>           Sample) <span class="sc">%&gt;%</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Total reads"</span> <span class="ot">=</span> <span class="fu">sum</span>(Reads)) <span class="sc">%&gt;%</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(Filter,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>          Site,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Total reads</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="identifying-singletons" class="level3" data-number="5.8">
<h3 data-number="5.8" class="anchored" data-anchor-id="identifying-singletons"><span class="header-section-number">5.8</span> Identifying singletons</h3>
<ul>
<li><p>Identifying species found in a single sample</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>Counts <span class="ot">&lt;-</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">count =</span> <span class="fu">n_distinct</span>(Sample),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>          Filter,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>          Sample) <span class="sc">%&gt;%</span> </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>unique_counts <span class="ot">&lt;-</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  Counts <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(count <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>      Sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
</section>
<section id="exploratory-plots" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="exploratory-plots"><span class="header-section-number">6</span> Exploratory plots</h2>
<ul>
<li><p>Define a custom function to sum unique values, necessary for pivoting data later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to handle character and numeric vectors when pivoting</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>sum_uniq <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(vec)) {</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>suniq <span class="ot">&lt;-</span> BiocGenerics<span class="sc">::</span><span class="fu">unique</span>(vec)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(vec)) {</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>suniq <span class="ot">&lt;-</span> <span class="fu">sum</span>(vec)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(suniq)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<section id="proportions-of-identified-taxa" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="proportions-of-identified-taxa"><span class="header-section-number">6.1</span> Proportions of identified taxa</h3>
<ul>
<li><p>This plot illustrates the proportion of species from different taxonomic orders, faceted by sampling site and grouped by reservoir water level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions of identified orders </span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fish_ord_all <span class="ot">&lt;-</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, Year, Filter, <span class="at">sep =</span> <span class="st">"_"</span>, </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">"un_amostral"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Order,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>       Site, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>       Year, </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>       Filter, </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>       un_amostral)) <span class="sc">%&gt;%</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Site, Year, Filter) <span class="sc">%&gt;%</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"alpha_d"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Order,Site, Year, Filter) <span class="sc">%&gt;%</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"alpha_d_order"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"alpha_d_order_%"</span> <span class="ot">=</span> </span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>       <span class="fu">round</span>(alpha_d_order <span class="sc">/</span> alpha_d <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(un_amostral) <span class="sc">%&gt;%</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year_Level =</span> <span class="fu">case_when</span>(Year <span class="sc">==</span> <span class="st">"2020"</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>                            Year <span class="sc">==</span> <span class="st">"2021"</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>                            Year <span class="sc">==</span> <span class="st">"2022"</span> <span class="sc">~</span> <span class="st">"High"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Filter <span class="sc">%in%</span> <span class="st">"MCE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year_Level,</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> alpha_d_order,</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> Order)) <span class="sc">+</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%0.1f%%"</span>,<span class="st">`</span><span class="at">alpha_d_order_%</span><span class="st">`</span>)),</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Site),</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">space =</span> <span class="st">"free"</span>,</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="st">"Orders"</span>)) <span class="sc">+</span></span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>)),</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>                                <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>)),</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.5</span>)),</span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>))) <span class="sc">+</span></span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgray"</span>,</span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">color =</span> <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#1f77b4"</span>,</span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#ff7f0e"</span>,</span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#2ca02c"</span>,</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#d62728"</span></span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>                           )) <span class="sc">+</span></span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Reservoir level"</span>, </span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Proportion of species"</span>)</span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fish_ord_all,</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>   <span class="at">filename =</span> <span class="fu">paste0</span>(figs_path, <span class="st">"/alpha_ord"</span>, <span class="st">"-"</span>, </span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>   <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>   <span class="at">height =</span> <span class="dv">20</span>,</span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>   <span class="at">width =</span> <span class="dv">30</span>,</span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>   <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>fish_ord_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
<li><p>This plot shows the proportion of species from different taxonomic families, faceted by sampling site and grouped by reservoir water level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportions of identified families</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fish_fam_all <span class="ot">&lt;-</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, Year, Filter,<span class="at">sep =</span> <span class="st">"_"</span>, </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">"un_amostral"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Order, </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>       Family,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>       Site, </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>       Year, </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>       Filter, </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>       un_amostral)) <span class="sc">%&gt;%</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Site, Year, Filter) <span class="sc">%&gt;%</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"alpha_d"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Family,Site, Year, Filter) <span class="sc">%&gt;%</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"alpha_d_order"</span> <span class="ot">=</span> <span class="fu">length</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"alpha_d_order_%"</span> <span class="ot">=</span> </span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">round</span>(alpha_d_order <span class="sc">/</span> alpha_d <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(un_amostral) <span class="sc">%&gt;%</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year_Level =</span> <span class="fu">case_when</span>(Year <span class="sc">==</span> <span class="st">"2020"</span> <span class="sc">~</span> <span class="st">"Full"</span>,</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>                            Year <span class="sc">==</span> <span class="st">"2021"</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>                            Year <span class="sc">==</span> <span class="st">"2022"</span> <span class="sc">~</span> <span class="st">"Full"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Filter <span class="sc">%in%</span> <span class="st">"MCE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year_Level,</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> alpha_d_order,</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> Family)) <span class="sc">+</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%0.1f%%"</span>,<span class="st">`</span><span class="at">alpha_d_order_%</span><span class="st">`</span>)),</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_fill</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(Site),</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">space =</span> <span class="st">"free"</span>,</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="st">"Family"</span>)) <span class="sc">+</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>)),</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>)),</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.5</span>)),</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.2</span>))) <span class="sc">+</span></span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">19</span>),</span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"lightgray"</span>,</span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">color =</span> <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#5d9cecff"</span>,</span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#4fc1e9ff"</span>,</span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#48cfadff"</span>,</span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#a0d468ff"</span>,</span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#ffce54ff"</span>,</span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#fc6e51ff"</span>,</span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#ed5565ff"</span>,</span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#ac92ecff"</span>,</span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"#ec87c0ff"</span></span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a>                           )) <span class="sc">+</span></span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Reservoir level"</span>, </span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Proportion of species"</span>)</span>
<span id="cb58-84"><a href="#cb58-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-85"><a href="#cb58-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fish_fam_all, </span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a>   <span class="at">filename =</span> <span class="fu">paste0</span>(figs_path, <span class="st">"/alpha_fam"</span>, <span class="st">"-"</span>, </span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a>   <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a>   <span class="at">height =</span> <span class="fl">20.5</span>,</span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a>   <span class="at">width =</span> <span class="dv">30</span>,</span>
<span id="cb58-92"><a href="#cb58-92" aria-hidden="true" tabindex="-1"></a>   <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb58-93"><a href="#cb58-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a>fish_fam_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
<section id="figure-2a" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="figure-2a"><span class="header-section-number">6.2</span> Figure 2A</h3>
<ul>
<li><p><strong>Figure 2A.</strong> <strong>Taxa composition across sampling sites and water levels.</strong> The tile plot displays the relative read abundance (RRA) of each taxa at different sites (P1–P4) and water levels (High and Low). (Char = Characiformes, Cich = Cichliformes, Sil = Siluriformes and Cypr = Cyprinodontiformes).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Defining order and species levels for factor ordering</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>order_levels <span class="ot">&lt;-</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl<span class="sc">$</span>Order <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>spp_levels <span class="ot">&lt;-</span> </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl<span class="sc">$</span><span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="sc">%&gt;%</span> </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Tile plot for all years </span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>tile_all <span class="ot">&lt;-</span> </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">factor</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, </span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">rev</span>(spp_levels)),</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">Site =</span> <span class="fu">factor</span>(Site),</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">Year_Level =</span> <span class="fu">case_when</span>(Year <span class="sc">==</span> <span class="st">"2020"</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>                            Year <span class="sc">==</span> <span class="st">"2021"</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>                            Year <span class="sc">==</span> <span class="st">"2022"</span> <span class="sc">~</span> <span class="st">"High"</span>),</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">Order_abrev =</span> <span class="fu">case_when</span>(Order <span class="sc">==</span> <span class="st">"Characiformes"</span> <span class="sc">~</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Char"</span>,</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>                            Order <span class="sc">==</span> <span class="st">"Cichliformes"</span> <span class="sc">~</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Cich"</span>,</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>                            Order <span class="sc">==</span> <span class="st">"Siluriformes"</span> <span class="sc">~</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Sil"</span>,</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>                            Order <span class="sc">==</span> <span class="st">"Cyprinodontiformes"</span> <span class="sc">~</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Cypr"</span>),</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">Order_abrev =</span> <span class="fu">factor</span>(Order_abrev, </span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Char"</span>, </span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"Cich"</span>,</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"Cypr"</span>, </span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"Sil"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> Site,</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> RRA)) <span class="sc">+</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(Year_Level),</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">rows =</span> <span class="fu">vars</span>(Order_abrev),</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">space =</span> <span class="st">"free"</span>,</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">drop =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">name =</span> <span class="st">"RRA (%)"</span>,</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">colours =</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"#30123BFF"</span>, </span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#4662D7FF"</span>, </span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"darkgreen"</span>, </span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#72FE5EFF"</span>, </span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#C7EF34FF"</span>, </span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#FABA39FF"</span>, </span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#F66B19FF"</span>, </span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#CB2A04FF"</span>, </span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"#7A0403FF"</span>)),</span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>,<span class="fl">0.05</span>, <span class="fl">0.25</span>,<span class="dv">1</span>, <span class="fl">2.5</span>,<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>)),</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">1.00</span>,<span class="fl">2.50</span>, <span class="fl">5.00</span>,<span class="fl">10.00</span>, <span class="fl">25.00</span>, <span class="fl">50.00</span>, <span class="fl">100.00</span>),</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number_format</span>(<span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>                   <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="dv">100</span>),</span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>                   <span class="at">na.value =</span> <span class="st">"#7A0403FF"</span>,</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trans =</span> <span class="st">"log10"</span>) <span class="sc">+</span></span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, </span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, </span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">"bold"</span>, </span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>                                <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">10</span>),</span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#e4e4e4"</span>),</span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>, </span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>, </span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a>                              <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>, </span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a>                               <span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">'cm'</span>)) <span class="sc">+</span></span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">'RRA (%)'</span>,</span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> <span class="st">"Sample site"</span>,</span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Taxa"</span>)</span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> tile_all,</span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a>   <span class="at">filename =</span> <span class="fu">paste0</span>(figs_path, <span class="st">"/tile_20-22"</span>, <span class="st">"-"</span>,</span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a>   <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a>   <span class="at">height =</span> <span class="fl">20.5</span>,</span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a>   <span class="at">width =</span> <span class="fl">25.5</span>,</span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a>   <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a>tile_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
<section id="alpha-diversity" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="alpha-diversity"><span class="header-section-number">6.3</span> Alpha diversity</h3>
<ul>
<li><p>Prepare data and create a phyloseq object to calculate alpha diversity indices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alpha diversity data preparation ----</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tax table</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>blast_tax_tbl <span class="ot">&lt;-</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"Curated ID"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Genus"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Family"</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Order"</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Class"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">rownames&lt;-</span><span class="st">`</span>(.<span class="sc">$</span><span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Curated ID"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co"># OTU table</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>otu_tbl <span class="ot">&lt;-</span> grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, </span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    Level, </span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    Year, <span class="at">col =</span> <span class="st">"Sample"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample, Reads, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_from =</span> Reads,</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">values_fn =</span> sum_uniq,</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_from =</span> Sample,</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">names_sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"P"</span>) ,</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">replace_na</span>(.,<span class="at">replace =</span> <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="co"># jaccarize</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"Curated ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">rowSums</span>(.)<span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">colSums</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%in%</span> <span class="dv">0</span>))</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Metadata table</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>metadata_tbl <span class="ot">&lt;-</span> grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, </span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a>    Level, </span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>    Year, <span class="at">col =</span> <span class="st">"Sample"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sample, Site, Level, Year) <span class="sc">%&gt;%</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">rownames&lt;-</span><span class="st">`</span>(.<span class="sc">$</span>Sample)</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Phyloseq object</span></span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>phyloseq_tbl <span class="ot">&lt;-</span> <span class="fu">phyloseq</span>(<span class="fu">otu_table</span>(otu_tbl, <span class="at">taxa_are_rows =</span> <span class="cn">TRUE</span>),</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">sample_data</span>(metadata_tbl),</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">tax_table</span>(blast_tax_tbl)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Estimate and plot species richness (Observed index) as a boxplot, comparing high and low water levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimating richness ----</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>rich_tbl <span class="ot">&lt;-</span> <span class="fu">estimate_richness</span>(phyloseq_tbl,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">split =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">measures =</span> <span class="fu">c</span>(<span class="st">"Observed"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Chao1"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Shannon"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"Simpson"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Sample"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> metadata_tbl,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"Sample"</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting richness</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>boxplot_alpha <span class="ot">&lt;-</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  rich_tbl <span class="sc">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Level, <span class="at">y =</span> Observed)) <span class="sc">+</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"#3381b1"</span>, </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"#f1c232"</span>),</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>,</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># width = 0.2,</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#e4e4e4"</span>),</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>,</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Water level"</span>,</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Richness"</span>)</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> boxplot_alpha,</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste</span>(figs_path, <span class="st">"/boxplot_alpha_levels-"</span>,</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"cm"</span>, </span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">9</span>, </span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">10</span>, </span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>boxplot_alpha</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
<section id="venn-diagram-analysis" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="venn-diagram-analysis"><span class="header-section-number">6.4</span> Venn Diagram Analysis</h3>
<ul>
<li><p>This section prepares data to identify common and exclusive species between different water levels and sampling sites. The resulting tables can be used to create Venn diagrams.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Venn diagram data preparation ----</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering for unique taxa per level/site</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>resume_venn <span class="ot">&lt;-</span> grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>         Genus, </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>         Family, </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>         Order, </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>         Filter, </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>         Level, </span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>         Site) <span class="sc">%&gt;%</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Common species between High and Low water levels</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>spp_comm <span class="ot">&lt;-</span> resume_venn <span class="sc">%&gt;%</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_Level =</span> <span class="fu">n_distinct</span>(Level)) <span class="sc">%&gt;%</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_Level <span class="sc">&gt;=</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>spp_comm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 1
  `Curated ID`         
  &lt;chr&gt;                
1 Astyanax lacustris   
2 Coptodon rendalli    
3 Hoplias intermedius  
4 Leporinus sp.        
5 Moenkhausia costae   
6 Oreochromis niloticus
7 Poecilia reticulata  
8 Psalidodon sp.       
9 Rhamdia quelen       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclusive species to High and Low water levels</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>spp_diff <span class="ot">&lt;-</span> resume_venn <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Low_count =</span> <span class="fu">sum</span>(<span class="fu">as.integer</span>(Level <span class="sc">==</span> <span class="st">"Low"</span>)),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">High_count =</span> <span class="fu">sum</span>(<span class="fu">as.integer</span>(Level <span class="sc">==</span> <span class="st">"High"</span>)),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">Low_only =</span> Low_count <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> High_count <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">High_only =</span> Low_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> High_count <span class="sc">&gt;=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>spp_diff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   `Curated ID`           Low_count High_count Low_only High_only
   &lt;chr&gt;                      &lt;int&gt;      &lt;int&gt; &lt;lgl&gt;    &lt;lgl&gt;    
 1 Astyanax lacustris             3          1 FALSE    FALSE    
 2 Coptodon rendalli              4          4 FALSE    FALSE    
 3 Hemigrammus marginatus         0          1 FALSE    TRUE     
 4 Hoplias intermedius            4          3 FALSE    FALSE    
 5 Hoplias malabaricus            0          1 FALSE    TRUE     
 6 Leporinus sp.                  1          1 FALSE    FALSE    
 7 Moenkhausia costae             1          2 FALSE    FALSE    
 8 Myleus micans                  1          0 TRUE     FALSE    
 9 Oreochromis niloticus          4          1 FALSE    FALSE    
10 Pimelodus sp.                  2          0 TRUE     FALSE    
11 Poecilia reticulata            3          1 FALSE    FALSE    
12 Psalidodon sp.                 4          1 FALSE    FALSE    
13 Rhamdia quelen                 4          1 FALSE    FALSE    
14 Schizodon knerii               0          1 FALSE    TRUE     
15 Serrasalmus brandtii           0          1 FALSE    TRUE     
16 Trichomycterus sp.             1          0 TRUE     FALSE    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Common species across all 4 sample sites</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>spp_comm_sites <span class="ot">&lt;-</span> resume_venn <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_Sites =</span> <span class="fu">n_distinct</span>(Site)) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_Sites <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>spp_comm_sites</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 1
  `Curated ID`         
  &lt;chr&gt;                
1 Coptodon rendalli    
2 Hoplias intermedius  
3 Oreochromis niloticus
4 Psalidodon sp.       
5 Rhamdia quelen       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclusive species to each sample site</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>spp_diff_sites <span class="ot">&lt;-</span> resume_venn <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">P1_count =</span> <span class="fu">sum</span>(<span class="fu">as.integer</span>(Site <span class="sc">==</span> <span class="st">"P1"</span>)),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">P2_count =</span> <span class="fu">sum</span>(<span class="fu">as.integer</span>(Site <span class="sc">==</span> <span class="st">"P2"</span>)),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">P3_count =</span> <span class="fu">sum</span>(<span class="fu">as.integer</span>(Site <span class="sc">==</span> <span class="st">"P3"</span>)),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">P4_count =</span> <span class="fu">sum</span>(<span class="fu">as.integer</span>(Site <span class="sc">==</span> <span class="st">"P4"</span>)),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">P1_only =</span> P1_count <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> P2_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>              P3_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> P4_count <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">P2_only =</span> P2_count <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> P1_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>              P3_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> P4_count <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">P3_only =</span> P3_count <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> P1_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> </span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>              P2_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> P4_count <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">P4_only =</span> P4_count <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> P1_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> </span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>              P2_count <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> P3_count <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>spp_diff_sites</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 9
   `Curated ID`      P1_count P2_count P3_count P4_count P1_only P2_only P3_only
   &lt;chr&gt;                &lt;int&gt;    &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;lgl&gt;   &lt;lgl&gt;   &lt;lgl&gt;  
 1 Astyanax lacustr…        0        2        1        1 FALSE   FALSE   FALSE  
 2 Coptodon rendalli        2        2        2        2 FALSE   FALSE   FALSE  
 3 Hemigrammus marg…        0        1        0        0 FALSE   TRUE    FALSE  
 4 Hoplias intermed…        2        2        1        2 FALSE   FALSE   FALSE  
 5 Hoplias malabari…        0        1        0        0 FALSE   TRUE    FALSE  
 6 Leporinus sp.            0        1        1        0 FALSE   FALSE   FALSE  
 7 Moenkhausia cost…        1        2        0        0 FALSE   FALSE   FALSE  
 8 Myleus micans            0        0        0        1 FALSE   FALSE   FALSE  
 9 Oreochromis nilo…        1        1        2        1 FALSE   FALSE   FALSE  
10 Pimelodus sp.            0        1        1        0 FALSE   FALSE   FALSE  
11 Poecilia reticul…        0        2        1        1 FALSE   FALSE   FALSE  
12 Psalidodon sp.           1        2        1        1 FALSE   FALSE   FALSE  
13 Rhamdia quelen           2        1        1        1 FALSE   FALSE   FALSE  
14 Schizodon knerii         0        0        1        0 FALSE   FALSE   TRUE   
15 Serrasalmus bran…        0        1        0        0 FALSE   TRUE    FALSE  
16 Trichomycterus s…        0        0        1        0 FALSE   FALSE   TRUE   
# ℹ 1 more variable: P4_only &lt;lgl&gt;</code></pre>
</div>
</div></li>
</ul>
</section>
</section>
<section id="ecological-analysis" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="ecological-analysis"><span class="header-section-number">7</span> Ecological analysis</h2>
<section id="pcoa" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="pcoa"><span class="header-section-number">7.1</span> PCoA</h3>
<section id="data-preparation-for-pcoa" class="level4" data-number="7.1.1">
<h4 data-number="7.1.1" class="anchored" data-anchor-id="data-preparation-for-pcoa"><span class="header-section-number">7.1.1</span> Data preparation for PCoA</h4>
<ul>
<li><p>Create a wide-format table (<code>Samples x Taxa</code>) with RRA values, which is required for ordination analysis in <code>vegan</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCoA Data Preparation ----</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new sample identifier by combining Site, Level, and Year</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>wider_filt_tbl_redux <span class="ot">&lt;-</span> grouped_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RRA =</span> <span class="fu">round</span>(RRA,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">digits =</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Site, </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>        Level, </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>        Year, <span class="at">col=</span> <span class="st">"New_sample"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the long table to a wide format (Samples x IDs)</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>FINAL_tbl_IDs_2 <span class="ot">&lt;-</span> wider_filt_tbl_redux <span class="sc">%&gt;%</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">"New_sample"</span>, </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Curated ID"</span>, </span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Year"</span>, </span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Level"</span>, </span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Site"</span>, </span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Filter"</span>, </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>           <span class="st">"RRA"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"New_sample"</span>, </span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Year"</span>, </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Level"</span>, </span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Site"</span>, </span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Filter"</span>),</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">`</span><span class="at">RRA</span><span class="st">`</span>,</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fn =</span> sum_uniq,</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_sort =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_prefix =</span> <span class="st">"ID_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(<span class="st">"New_sample"</span>, </span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Year"</span>, </span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Level"</span>, </span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Filter"</span>, </span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Site"</span>, <span class="fu">starts_with</span>(<span class="st">"ID_"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"ID_"</span>), </span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>                \(x) <span class="fu">replace_na</span>(x, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Site"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(Site)) <span class="sc">%&gt;%</span></span>
<span id="cb70-39"><a href="#cb70-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Level"</span> <span class="ot">=</span> <span class="fu">as.factor</span>(Level)) </span>
<span id="cb70-40"><a href="#cb70-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-41"><a href="#cb70-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the final dataframe for vegan</span></span>
<span id="cb70-42"><a href="#cb70-42" aria-hidden="true" tabindex="-1"></a>all_IDs_PCoA_df <span class="ot">&lt;-</span> FINAL_tbl_IDs_2 <span class="sc">%&gt;%</span></span>
<span id="cb70-43"><a href="#cb70-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Sample number"</span> <span class="ot">=</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb70-44"><a href="#cb70-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">"Sample number"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-45"><a href="#cb70-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb70-46"><a href="#cb70-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-47"><a href="#cb70-47" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(all_IDs_PCoA_df) <span class="ot">&lt;-</span> </span>
<span id="cb70-48"><a href="#cb70-48" aria-hidden="true" tabindex="-1"></a>  all_IDs_PCoA_df<span class="sc">$</span><span class="st">`</span><span class="at">Sample number</span><span class="st">`</span></span>
<span id="cb70-49"><a href="#cb70-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-50"><a href="#cb70-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean species names to avoid plotting issues</span></span>
<span id="cb70-51"><a href="#cb70-51" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_IDs_PCoA_df)[<span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(all_IDs_PCoA_df)] <span class="ot">&lt;-</span> </span>
<span id="cb70-52"><a href="#cb70-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(all_IDs_PCoA_df)[<span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(all_IDs_PCoA_df)] <span class="sc">%&gt;%</span></span>
<span id="cb70-53"><a href="#cb70-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="at">pattern =</span> <span class="st">" "</span>, <span class="at">replacement =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-54"><a href="#cb70-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="at">replacement =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-55"><a href="#cb70-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">("</span>, <span class="at">replacement =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-56"><a href="#cb70-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">)"</span>, <span class="at">replacement =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="executing-and-plotting-pcoa" class="level4" data-number="7.1.2">
<h4 data-number="7.1.2" class="anchored" data-anchor-id="executing-and-plotting-pcoa"><span class="header-section-number">7.1.2</span> Executing and Plotting PCoA</h4>
<ul>
<li><p>Perform the Principal Coordinates Analysis (PCoA) on a Jaccard distance matrix to visualize community composition differences between high and low water levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data and create distance matrix</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>MCE_all_IDs_PCoA_df <span class="ot">&lt;-</span> all_IDs_PCoA_df <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">any</span>(. <span class="sc">!=</span> <span class="dv">0</span>)))</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>pcOa_dist <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">vegdist</span>(<span class="at">x =</span> MCE_all_IDs_PCoA_df[,<span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(MCE_all_IDs_PCoA_df)],</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"jaccard"</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">binary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Run PCoA</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>pcOa <span class="ot">&lt;-</span> <span class="fu">cmdscale</span>(pcOa_dist, <span class="at">eig =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiplot</span>(pcOa, <span class="at">display =</span> <span class="st">'sites'</span>, <span class="at">type =</span> <span class="st">'text'</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit species vectors to the ordination</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>meta.spp.fit <span class="ot">&lt;-</span> <span class="fu">envfit</span>(pcOa,MCE_all_IDs_PCoA_df[,<span class="dv">8</span><span class="sc">:</span><span class="fu">ncol</span>(MCE_all_IDs_PCoA_df)], <span class="at">permutations =</span> <span class="dv">999</span>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract scores for significant species</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>sps_pvals <span class="ot">&lt;-</span> </span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="st">"IDs"</span> <span class="ot">=</span> <span class="fu">names</span>(meta.spp.fit<span class="sc">$</span>vectors<span class="sc">$</span>pvals),</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">"p-value"</span> <span class="ot">=</span> meta.spp.fit<span class="sc">$</span>vectors<span class="sc">$</span>pvals)</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>spp.scrs <span class="ot">&lt;-</span> </span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(meta.spp.fit, </span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">display =</span> <span class="st">"vectors"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"IDs"</span> <span class="ot">=</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> sps_pvals, </span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"IDs"</span>)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>spp.scrs<span class="sc">$</span>IDs <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ID_"</span>, <span class="st">""</span>, </span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>                     spp.scrs<span class="sc">$</span>IDs)</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>spp.scrs<span class="sc">$</span>IDs <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_"</span>, <span class="st">" "</span>, </span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>                     spp.scrs<span class="sc">$</span>IDs)</span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>sig.spp.scrs <span class="ot">&lt;-</span> spp.scrs <span class="sc">%&gt;%</span> </span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">p-value</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="fl">0.05</span>)</span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract site scores and centroids</span></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>site.scrs <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">scores</span>(pcOa, </span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">display =</span> <span class="st">"sites"</span>))</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(site.scrs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PCoA1"</span>, <span class="st">"PCoA2"</span>)</span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>site.scrs <span class="ot">&lt;-</span> site.scrs <span class="sc">%&gt;%</span></span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Sample number"</span> <span class="ot">=</span> <span class="fu">as.double</span>(<span class="fu">row.names</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="at">y =</span> MCE_all_IDs_PCoA_df[, <span class="fu">c</span>(<span class="st">"Sample number"</span>,</span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"New_sample"</span>,</span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Level"</span>, </span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Site"</span>)], </span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"Sample number"</span>)</span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a>cent <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(<span class="fu">cbind</span>(PCoA1, PCoA2) <span class="sc">~</span> Level, </span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> site.scrs, </span>
<span id="cb71-54"><a href="#cb71-54" aria-hidden="true" tabindex="-1"></a>                  <span class="at">FUN =</span> <span class="st">"mean"</span>)</span>
<span id="cb71-55"><a href="#cb71-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-56"><a href="#cb71-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ellipses for plotting</span></span>
<span id="cb71-57"><a href="#cb71-57" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">ordiellipse</span>(<span class="at">ord =</span> pcOa,</span>
<span id="cb71-58"><a href="#cb71-58" aria-hidden="true" tabindex="-1"></a>                   <span class="at">groups =</span> MCE_all_IDs_PCoA_df<span class="sc">$</span>Level,</span>
<span id="cb71-59"><a href="#cb71-59" aria-hidden="true" tabindex="-1"></a>                   <span class="at">display =</span> <span class="st">"sites"</span>,</span>
<span id="cb71-60"><a href="#cb71-60" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kind =</span> <span class="st">"ehull"</span>, </span>
<span id="cb71-61"><a href="#cb71-61" aria-hidden="true" tabindex="-1"></a>                   <span class="at">conf =</span> <span class="fl">0.95</span>, </span>
<span id="cb71-62"><a href="#cb71-62" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df_ell <span class="ot">&lt;-</span> <span class="fu">data.frame</span>() </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(g <span class="cf">in</span> <span class="fu">levels</span>(<span class="fu">as.factor</span>(MCE_all_IDs_PCoA_df<span class="sc">$</span>Level))){</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  df_ell <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_ell,<span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(<span class="fu">with</span>(site.scrs[site.scrs<span class="sc">$</span>Level<span class="sc">==</span>g,],vegan<span class="sc">:::</span><span class="fu">veganCovEllipse</span>(</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    ord[[g]]<span class="sc">$</span>cov,ord[[g]]<span class="sc">$</span>center,ord[[g]]<span class="sc">$</span>scale))),<span class="at">Level=</span>g))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
<section id="figure-2c" class="level4" data-number="7.1.3">
<h4 data-number="7.1.3" class="anchored" data-anchor-id="figure-2c"><span class="header-section-number">7.1.3</span> FIgure 2C</h4>
<ul>
<li><p><strong>Figure 2C.</strong> <strong>Principal Coordinates Analysis (PCoA) of fish community 𝛽-diversity composition for high vs low reservoir water levels</strong>. Sampling sites (P1–P4) from the high-level water state are enclosed in the blue ellipse, while those from the low-water level are within the red ellipse. Arrows represent taxa contributions to community differentiation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>percent_pcOa <span class="ot">&lt;-</span> pcOa<span class="sc">$</span>eig <span class="sc">/</span> <span class="fu">sum</span>(pcOa<span class="sc">$</span>eig) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#3381b1"</span>, </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>PCoA_MCE_2 <span class="ot">&lt;-</span> </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> site.scrs, </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x=</span>PCoA1, <span class="at">y=</span>PCoA2)) <span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ellipses</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_mark_ellipse</span>(<span class="at">data =</span> df_ell,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">aes</span>(<span class="at">x =</span> Dim1, </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y =</span> Dim2, <span class="at">group =</span> Level,</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">label =</span> Level, </span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">col =</span> Level, <span class="at">fill =</span> Level),</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>                             <span class="at">alpha=</span><span class="fl">0.10</span>, <span class="at">linetype=</span><span class="dv">2</span>, </span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">expand =</span> <span class="dv">0</span>, <span class="at">label.fontsize =</span> <span class="dv">20</span>,</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">con.cap =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample points</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Level, </span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col=</span>Level, </span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">group =</span> Level, </span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> Site), </span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">stroke =</span> <span class="fl">0.5</span>, </span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.75</span>, </span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample labels</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> Site), </span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">size=</span><span class="dv">6</span>, <span class="at">direction =</span> <span class="st">"both"</span>,</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>                           <span class="at">segment.size =</span> <span class="fl">0.25</span>,</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>                           <span class="at">segment.alpha=</span><span class="fl">0.1</span>, <span class="at">force =</span> <span class="dv">3</span>,</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">max.overlaps =</span> <span class="dv">100</span>, </span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Species vectors</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> sig.spp.scrs, </span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> Dim1, </span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> Dim2),</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.1</span>, <span class="st">"cm"</span>)),</span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey30"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Species labels</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> sig.spp.scrs, </span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x=</span>Dim1, <span class="at">y=</span>Dim2, <span class="at">label =</span> IDs),</span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">alpha =</span> <span class="fl">0.75</span>, </span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.size =</span> <span class="fl">0.25</span>, </span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.alpha =</span> <span class="fl">0.1</span>, </span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">max.overlaps =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Centroids</span></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> cent, </span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> PCoA1, </span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> PCoA2, </span>
<span id="cb73-51"><a href="#cb73-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> Level),</span>
<span id="cb73-52"><a href="#cb73-52" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">8</span>, </span>
<span id="cb73-53"><a href="#cb73-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> <span class="st">"#222222"</span>,</span>
<span id="cb73-54"><a href="#cb73-54" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.75</span>, </span>
<span id="cb73-55"><a href="#cb73-55" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape  =</span> <span class="dv">13</span>) <span class="sc">+</span></span>
<span id="cb73-56"><a href="#cb73-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb73-57"><a href="#cb73-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>, </span>
<span id="cb73-58"><a href="#cb73-58" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="fl">0.2</span>, </span>
<span id="cb73-59"><a href="#cb73-59" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb73-60"><a href="#cb73-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">17</span>, </span>
<span id="cb73-61"><a href="#cb73-61" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb73-62"><a href="#cb73-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb73-63"><a href="#cb73-63" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb73-64"><a href="#cb73-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb73-65"><a href="#cb73-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">"PCoA1 ("</span>, </span>
<span id="cb73-66"><a href="#cb73-66" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>(percent_pcOa, <span class="dv">2</span>), <span class="st">"%)"</span>)[<span class="dv">1</span>],</span>
<span id="cb73-67"><a href="#cb73-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">"PCoA2 ("</span>, </span>
<span id="cb73-68"><a href="#cb73-68" aria-hidden="true" tabindex="-1"></a>              <span class="fu">round</span>(percent_pcOa, <span class="dv">2</span>), <span class="st">"%)"</span>)[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb73-69"><a href="#cb73-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cores) <span class="sc">+</span></span>
<span id="cb73-70"><a href="#cb73-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> cores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> PCoA_MCE_2, </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">filename =</span> <span class="fu">paste0</span>(figs_path, <span class="st">"/PCoA_all"</span>, <span class="st">"-"</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"cm"</span>, </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">16.75</span>, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="fl">16.75</span>, </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>PCoA_MCE_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
</section>
<section id="permanova" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="permanova"><span class="header-section-number">7.2</span> PERMANOVA</h3>
<ul>
<li><p>Perform a PERMANOVA (<code>adonis2</code>) to statistically test for significant differences in community composition between water levels, and check for homogeneity of multivariate dispersions (<code>betadisper</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create distance matrix (if not already created for PCoA)</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>pcOa_mtx <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(pcOa_dist)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Test assumption of homogeneity of dispersions</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>Dispersion <span class="ot">&lt;-</span> <span class="fu">betadisper</span>(pcOa_dist, </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">group =</span> MCE_all_IDs_PCoA_df<span class="sc">$</span>Level,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="st">"centroid"</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Dispersion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(Dispersion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Distances
          Df   Sum Sq  Mean Sq F value   Pr(&gt;F)   
Groups     1 0.111819 0.111819  23.852 0.002755 **
Residuals  6 0.028128 0.004688                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PERMANOVA test</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>perma_test <span class="ot">&lt;-</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adonis2</span>(pcOa_mtx <span class="sc">~</span> <span class="fu">as.factor</span>(MCE_all_IDs_PCoA_df<span class="sc">$</span>Level),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> <span class="fu">as.data.frame</span>(pcOa_mtx),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">permutations=</span><span class="dv">9999</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>perma_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Terms added sequentially (first to last)
Permutation: free
Number of permutations: 9999

adonis2(formula = pcOa_mtx ~ as.factor(MCE_all_IDs_PCoA_df$Level), data = as.data.frame(pcOa_mtx), permutations = 9999)
                                     Df SumOfSqs     R2      F Pr(&gt;F)  
as.factor(MCE_all_IDs_PCoA_df$Level)  1  0.39416 0.2725 2.2474 0.0542 .
Residual                              6  1.05231 0.7275                
Total                                 7  1.44647 1.0000                
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div></li>
</ul>
</section>
<section id="species-accumulation-curves" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="species-accumulation-curves"><span class="header-section-number">7.3</span> Species accumulation curves</h3>
<ul>
<li><p>Generate species accumulation curves to assess how richness increases with the number of samples, calculated for all samples combined and separately for high and low water levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data: wide format (samples x species), presence/absence</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>wider_grouped_sampled_filt <span class="ot">&lt;-</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  grouped_sampled_filt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Filter <span class="sc">%in%</span> <span class="st">"MCE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Sample, </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>           Site, </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>           Level, </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>           Reads, </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>           Expedition, </span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>           Filter)) <span class="sc">%&gt;%</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample, <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>, Reads) <span class="sc">%&gt;%</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  unique <span class="sc">%&gt;%</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">`</span><span class="at">Curated ID</span><span class="st">`</span>,</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Reads,</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace_na</span>(.x, <span class="dv">0</span>)))</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>jaccarize <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>) </span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>wider_grouped_sampled_filt_pa <span class="ot">&lt;-</span> </span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>  wider_grouped_sampled_filt <span class="sc">%&gt;%</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(.)), jaccarize))</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate accumulation curve for all MCE samples</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>accum_mce <span class="ot">&lt;-</span> </span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specaccum</span>(wider_grouped_sampled_filt_pa[<span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(wider_grouped_sampled_filt_pa)], <span class="at">method =</span> <span class="st">"random"</span>)</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>accum_mce_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Sites"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_mce<span class="sc">$</span>sites), <span class="st">"Richness"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_mce<span class="sc">$</span>richness), <span class="st">"sd"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_mce<span class="sc">$</span>sd), <span class="st">"Level"</span> <span class="ot">=</span> <span class="st">"All"</span>)</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate for Low-level samples only</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>wider_grouped_sampled_filt_low <span class="ot">&lt;-</span> wider_grouped_sampled_filt_pa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Level <span class="sc">%in%</span> <span class="st">"Low"</span>)</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>accum_low <span class="ot">&lt;-</span> <span class="fu">specaccum</span>(wider_grouped_sampled_filt_low[<span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(wider_grouped_sampled_filt_low)], <span class="at">method =</span> <span class="st">"random"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Set of permutations &lt; 'minperm'. Generating entire set.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>accum_low_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Sites"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_low<span class="sc">$</span>sites), <span class="st">"Richness"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_low<span class="sc">$</span>richness), <span class="st">"sd"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_low<span class="sc">$</span>sd), <span class="st">"Level"</span> <span class="ot">=</span> <span class="st">"Low"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate for High-level samples only</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>wider_grouped_sampled_filt_high <span class="ot">&lt;-</span> wider_grouped_sampled_filt_pa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Level <span class="sc">%in%</span> <span class="st">"High"</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>accum_full <span class="ot">&lt;-</span> <span class="fu">specaccum</span>(wider_grouped_sampled_filt_high[<span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(wider_grouped_sampled_filt_high)], <span class="at">method =</span> <span class="st">"random"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Set of permutations &lt; 'minperm'. Generating entire set.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>accum_full_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Sites"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_full<span class="sc">$</span>sites), <span class="st">"Richness"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_full<span class="sc">$</span>richness), <span class="st">"sd"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, accum_full<span class="sc">$</span>sd), <span class="st">"Level"</span> <span class="ot">=</span> <span class="st">"High"</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine and plot</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>combined_accum <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(accum_mce_df, accum_low_df, accum_full_df) <span class="sc">%&gt;%</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Level =</span> <span class="fu">factor</span>(Level, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"All"</span>, </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"Low"</span>, </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">"High"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<section id="figure-2b" class="level4" data-number="7.3.1">
<h4 data-number="7.3.1" class="anchored" data-anchor-id="figure-2b"><span class="header-section-number">7.3.1</span> Figure 2B</h4>
<ul>
<li><p><strong>Figure 2B. Species accumulation curves.</strong> 241 All samples (green), reservoir at high-level reservoir (blue), reservoir at low-level (red). Vertical bars represent the 95% confidence 242 intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>collector_plot_all <span class="ot">&lt;-</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  combined_accum <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Sites,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Richness,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> Level,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> Level )) <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.50</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Richness <span class="sc">-</span> sd, </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> Richness <span class="sc">+</span> sd, </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colour=</span>Level), <span class="at">width=</span>.<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"All"</span> <span class="ot">=</span> <span class="st">"#2A6B33"</span>, </span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>, </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#457B9D"</span>),</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"All"</span> <span class="ot">=</span> <span class="st">"All samples"</span>, </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"Low-level"</span>, </span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"High-level"</span>)) <span class="sc">+</span></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span><span class="fu">seq</span>(<span class="dv">0</span>,</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">max</span>(combined_accum<span class="sc">$</span>Sites),</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">by =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">max</span>(combined_accum<span class="sc">$</span>Richness),</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> combined_accum <span class="sc">%&gt;%</span></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">arrange</span>(<span class="fu">desc</span>(Sites)) <span class="sc">%&gt;%</span> </span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">distinct</span>(Level, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>),</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">recode</span>(Level, </span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"All"</span> <span class="ot">=</span> <span class="st">"All samples"</span>,</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"Low-level"</span>,</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"High-level"</span>),</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> Level),</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size =</span> <span class="dv">7</span>, </span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fontface =</span> <span class="st">"bold"</span>, </span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nudge_y =</span> <span class="dv">3</span>, </span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">box.padding =</span> <span class="dv">1</span>, </span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">point.padding =</span> <span class="fl">0.5</span>, </span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">segment.color =</span> <span class="st">"grey50"</span>, </span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey"</span>,</span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linewidth =</span> <span class="fl">0.2</span>,</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="dv">17</span>),</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">size =</span> <span class="dv">20</span>, </span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#e4e4e4"</span>),</span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Number of samples"</span>, </span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Richness"</span>)</span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Exporting plot for the paper</span></span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">file =</span> <span class="fu">paste0</span>(figs_path,<span class="st">"/"</span>, <span class="st">"collector_plot_all"</span>,</span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"-"</span>, <span class="fu">Sys.Date</span>(), <span class="st">".pdf"</span>, <span class="at">collapse =</span> <span class="st">""</span>),</span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> collector_plot_all, </span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">20</span>, </span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> <span class="dv">12</span>, </span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">units =</span> <span class="st">"cm"</span>, </span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>collector_plot_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="LI_script_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div></li>
</ul>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="LI_script_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>